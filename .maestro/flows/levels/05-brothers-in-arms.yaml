# Campaign Level 5: Brothers in Arms
# Reunite with Marcus Cole, mech combat support
# Cross-platform: Web, Android, iOS

appId: "${PLATFORM == 'android' ? 'com.jbcom.stellardescent' : (PLATFORM == 'ios' ? 'com.jbcom.stellardescent' : null)}"
url: "${PLATFORM == 'web' ? 'http://localhost:8080' : null}"
tags:
  - campaign
  - level-5
  - mech
  - coop-ai
name: "Campaign Level 5 - Brothers in Arms"

---
- launchApp:
    clearState: true

# Wait for main menu
- extendedWaitUntil:
    visible: "SELECT MISSION"
    timeout: 30000

# Open level select
- tapOn:
    text: "SELECT MISSION"

- wait: 1000

# Look for Brothers in Arms (Chapter 5)
- assertVisible:
    text: "CHAPTER 5"
    optional: true
    timeout: 5000

# Select Brothers in Arms if unlocked
- tapOn:
    text: "BROTHERS IN ARMS"
    optional: true

- wait: 500

- takeScreenshot: "level_05_select_state"

# Wait for mission briefing
- assertVisible:
    text: "MISSION BRIEFING"
    optional: true
    timeout: 10000

# Verify mission details
- assertVisible:
    text: "BROTHERS IN ARMS"
    optional: true

- assertVisible:
    text: "Marcus Cole"
    optional: true

- assertVisible:
    text: "ACT 2: THE SEARCH"
    optional: true

- takeScreenshot: "level_05_briefing"

# Check intel for enemy types
- tapOn:
    text: "INTEL"
    optional: true

- wait: 500

# Should show CHITIN BRUTE and SWARM WAVE intel
- assertVisible:
    text: "CHITIN BRUTE"
    optional: true

- assertVisible:
    text: "SWARM WAVE"
    optional: true

- takeScreenshot: "level_05_intel"

# Check loadout tab
- tapOn:
    text: "LOADOUT"
    optional: true

- wait: 500

# Should show rocket launcher for anti-armor
- assertVisible:
    text: "ROCKET LAUNCHER"
    optional: true

- takeScreenshot: "level_05_loadout"

# Begin mission
- tapOn:
    text: "BEGIN MISSION"
    optional: true

# Wait for loading
- extendedWaitUntil:
    visible: "SYSTEMS ONLINE"
    timeout: 60000
    optional: true

- wait: 3000

- takeScreenshot: "level_05_start"

# Look for mech ally indicator
- assertVisible:
    text: "TITAN"
    optional: true
    timeout: 10000

- takeScreenshot: "level_05_mech_ally"

# Combat movement
- repeat:
    times: 3
    commands:
      - swipe:
          start: "10%, 70%"
          end: "18%, 58%"
          duration: 2000
      - wait: 300
      - swipe:
          start: "80%, 50%"
          end: "75%, 45%"
          duration: 800
      - wait: 200
      - tapOn:
          id: "fire-button"
          optional: true
      - wait: 500

- takeScreenshot: "level_05_combat"

# Use heavy weapon if available
- tapOn:
    id: "weapon-switch"
    optional: true

- wait: 500

- tapOn:
    id: "fire-button"
    optional: true

- wait: 2000

- takeScreenshot: "level_05_gameplay"
