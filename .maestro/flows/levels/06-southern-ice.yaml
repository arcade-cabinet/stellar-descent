# Campaign Level 6: Southern Ice
# Frozen wasteland with cold-adapted enemy variants (Ice Chitin)
# Full E2E flow testing all level mechanics
# Cross-platform: Web, Android, iOS

appId: "${PLATFORM == 'android' ? 'com.jbcom.stellardescent' : (PLATFORM == 'ios' ? 'com.jbcom.stellardescent' : null)}"
url: "${PLATFORM == 'web' ? 'http://localhost:8080' : null}"
tags:
  - campaign
  - level-6
  - ice
  - new-enemies
  - e2e
  - southern-ice
name: "Campaign Level 6 - Southern Ice E2E"

---
# ============================================================================
# PHASE 1: LEVEL SELECTION AND MISSION BRIEFING
# ============================================================================

- launchApp:
    clearState: true

# Wait for main menu to fully load
- extendedWaitUntil:
    visible: "SELECT MISSION"
    timeout: 30000

- takeScreenshot: "level_06_main_menu"

# Open level select
- tapOn:
    text: "SELECT MISSION"

- wait: 1500

# Verify chapter 6 is visible (unlocked if player completed chapter 5)
- assertVisible:
    text: "CHAPTER 6"
    optional: true
    timeout: 5000

# Select Southern Ice level
- tapOn:
    text: "SOUTHERN ICE"
    optional: true

- wait: 500

- takeScreenshot: "level_06_level_select"

# ============================================================================
# PHASE 2: MISSION BRIEFING VERIFICATION
# ============================================================================

# Wait for mission briefing screen
- extendedWaitUntil:
    visible: "MISSION BRIEFING"
    timeout: 10000
    optional: true

# Verify mission title and details
- assertVisible:
    text: "SOUTHERN ICE"
    optional: true

- assertVisible:
    text: "Polar Region"
    optional: true

- assertVisible:
    text: "ACT 3"
    optional: true

- takeScreenshot: "level_06_briefing"

# Check intel tab for Ice Chitin enemy details
- tapOn:
    text: "INTEL"
    optional: true

- wait: 800

# Verify new enemy type is documented
- assertVisible:
    text: "FROST CHITIN"
    optional: true

- assertVisible:
    text: "ICE"
    optional: true

- assertVisible:
    text: "cold-adapted"
    optional: true

- takeScreenshot: "level_06_intel_tab"

# Check loadout for cold environment gear
- tapOn:
    text: "LOADOUT"
    optional: true

- wait: 800

# Verify recommended loadout items
- assertVisible:
    text: "FLAMETHROWER"
    optional: true

- assertVisible:
    text: "THERMAL"
    optional: true

- takeScreenshot: "level_06_loadout_tab"

# Begin mission
- tapOn:
    text: "BEGIN MISSION"
    optional: true

# ============================================================================
# PHASE 3: ICE FIELDS - BLIZZARD ENVIRONMENT
# ============================================================================

# Wait for level to load and HUD to appear
- extendedWaitUntil:
    visible: "SYSTEMS ONLINE"
    timeout: 60000
    optional: true

- wait: 3000

# Verify initial objective
- assertVisible:
    text: "TRAVERSE"
    optional: true

- takeScreenshot: "level_06_ice_fields_start"

# Verify chapter notification appeared
- assertVisible:
    text: "CHAPTER 6"
    optional: true
    timeout: 5000

# Move forward through the blizzard
- swipe:
    start: "10%, 70%"
    end: "15%, 55%"
    duration: 3000

- wait: 2000

# Verify blizzard weather effects are visible (reduced visibility)
- takeScreenshot: "level_06_blizzard_effects"

# Marcus companion should provide overwatch comms
- assertVisible:
    text: "IRONJAW"
    optional: true
    timeout: 10000

- takeScreenshot: "level_06_marcus_comms"

# Continue towards heat source
- swipe:
    start: "10%, 70%"
    end: "18%, 60%"
    duration: 4000

- wait: 1500

# Check for temperature/exposure warning if player stays in cold too long
- assertVisible:
    text: "TEMPERATURE"
    optional: true
    timeout: 8000

- takeScreenshot: "level_06_temperature_system"

# ============================================================================
# PHASE 4: COMBAT WITH ICE CHITIN ENEMIES
# ============================================================================

# Look for enemies (aim)
- swipe:
    start: "80%, 50%"
    end: "70%, 45%"
    duration: 1000

# Fire at enemies
- tapOn:
    id: "fire-button"
    optional: true

- wait: 200

- tapOn:
    id: "fire-button"
    optional: true

- wait: 200

- tapOn:
    id: "fire-button"
    optional: true

- takeScreenshot: "level_06_ice_chitin_combat"

# Check for hit confirmation
- assertVisible:
    text: "+"
    optional: true
    timeout: 3000

# Continue combat
- repeat:
    times: 3
    commands:
      - tapOn:
          id: "fire-button"
          optional: true
      - wait: 300

- takeScreenshot: "level_06_combat_progress"

# ============================================================================
# PHASE 5: FROZEN LAKE - THIN ICE MECHANICS
# ============================================================================

# Move forward towards frozen lake
- swipe:
    start: "10%, 70%"
    end: "15%, 50%"
    duration: 5000

- wait: 2000

# Check for phase transition notification
- assertVisible:
    text: "FROZEN LAKE"
    optional: true
    timeout: 10000

- takeScreenshot: "level_06_frozen_lake_phase"

# Check for thin ice warning
- assertVisible:
    text: "THIN ICE"
    optional: true
    timeout: 8000

# Verify Marcus stays behind (too heavy for ice)
- assertVisible:
    text: "overwatch"
    optional: true
    timeout: 5000

- takeScreenshot: "level_06_thin_ice_warning"

# Navigate carefully across lake
- swipe:
    start: "10%, 70%"
    end: "12%, 60%"
    duration: 3000

- wait: 1500

# Check for ice creaking audio/visual feedback
- takeScreenshot: "level_06_crossing_lake"

# Look for dormant nests awakening
- wait: 2000

- assertVisible:
    text: "AWAKENING"
    optional: true
    timeout: 8000

- takeScreenshot: "level_06_dormant_nests"

# Combat against awakened Ice Chitins
- swipe:
    start: "80%, 50%"
    end: "65%, 48%"
    duration: 800

- tapOn:
    id: "fire-button"
    optional: true

- wait: 200

- tapOn:
    id: "fire-button"
    optional: true

- takeScreenshot: "level_06_awakened_combat"

# ============================================================================
# PHASE 6: ICE CAVERNS - CHITIN NEST
# ============================================================================

# Continue forward towards ice caverns
- swipe:
    start: "10%, 70%"
    end: "18%, 55%"
    duration: 6000

- wait: 2000

# Check for ice caverns phase transition
- assertVisible:
    text: "ICE CAVERNS"
    optional: true
    timeout: 10000

- takeScreenshot: "level_06_ice_caverns_entry"

# Verify objective update
- assertVisible:
    text: "CLEAR"
    optional: true
    timeout: 5000

# Marcus rejoins inside caverns
- assertVisible:
    text: "squeeze through"
    optional: true
    timeout: 8000

- takeScreenshot: "level_06_marcus_rejoins"

# Heavy combat inside the nest
- repeat:
    times: 4
    commands:
      - swipe:
          start: "80%, 50%"
          end: "75%, 45%"
          duration: 600
      - tapOn:
          id: "fire-button"
          optional: true
      - wait: 400
      - tapOn:
          id: "fire-button"
          optional: true
      - wait: 300

- takeScreenshot: "level_06_cavern_combat"

# Use grenade against cluster of enemies
- tapOn:
    text: "GRENADE"
    optional: true

- wait: 1000

- takeScreenshot: "level_06_grenade_attack"

# Continue through caverns
- swipe:
    start: "10%, 70%"
    end: "15%, 55%"
    duration: 4000

- wait: 1500

# Check for ambient lighting change (warmer inside caves)
- takeScreenshot: "level_06_cave_interior"

# ============================================================================
# PHASE 7: APPROACH THE BREACH
# ============================================================================

# Navigate towards the southern hive entrance
- swipe:
    start: "10%, 70%"
    end: "18%, 50%"
    duration: 5000

- wait: 2000

# Check for hive entrance sighting
- assertVisible:
    text: "hive entrance"
    optional: true
    timeout: 10000

- takeScreenshot: "level_06_hive_entrance"

# Objective should update to reach the breach
- assertVisible:
    text: "BREACH"
    optional: true
    timeout: 8000

- takeScreenshot: "level_06_objective_breach"

# ============================================================================
# PHASE 8: LEVEL COMPLETION
# ============================================================================

# Move to trigger victory
- swipe:
    start: "10%, 70%"
    end: "15%, 50%"
    duration: 4000

- wait: 3000

# Check for level complete notification
- assertVisible:
    text: "Good work"
    optional: true
    timeout: 15000

- takeScreenshot: "level_06_completion_comms"

# Wait for mission complete screen
- extendedWaitUntil:
    visible: "MISSION COMPLETE"
    timeout: 30000
    optional: true

- takeScreenshot: "level_06_mission_complete"

# Verify mission statistics
- assertVisible:
    text: "KILLS"
    optional: true

- assertVisible:
    text: "TIME"
    optional: true

- assertVisible:
    text: "ACCURACY"
    optional: true

- takeScreenshot: "level_06_statistics"

# Check for unlocks/rewards
- assertVisible:
    text: "UNLOCKED"
    optional: true
    timeout: 5000

# Continue to next level or return to menu
- tapOn:
    text: "CONTINUE"
    optional: true

- wait: 2000

- takeScreenshot: "level_06_end_state"

# ============================================================================
# VERIFICATION: ALL KEY MECHANICS TESTED
# ============================================================================
# - Level selection and mission briefing
# - Ice fields phase with blizzard effects
# - Temperature/exposure system
# - Marcus AI companion
# - Ice Chitin enemy combat
# - Frozen lake thin ice mechanics
# - Dormant nest awakening
# - Ice caverns phase
# - Phase transitions
# - Level completion flow
