# Campaign Level 3: Canyon Run
# Vehicle chase through canyons
# Cross-platform: Web, Android, iOS

appId: ${PLATFORM == 'android' ? 'com.jbcom.stellardescent' : (PLATFORM == 'ios' ? 'com.jbcom.stellardescent' : null)}
url: ${PLATFORM == 'web' ? 'http://localhost:8080' : null}
tags:
  - campaign
  - level-3
  - vehicle
  - chase
name: "Campaign Level 3 - Canyon Run"

---
- launchApp:
    clearState: true

# Wait for main menu
- extendedWaitUntil:
    visible: "SELECT MISSION"
    timeout: 30000

# Open level select
- tapOn:
    text: "SELECT MISSION"

- wait: 1000

# Look for Canyon Run in level select (Chapter 3)
- assertVisible:
    text: "CHAPTER 3"
    optional: true
    timeout: 5000

# Select Canyon Run if unlocked
- tapOn:
    text: "CANYON RUN"
    optional: true

- wait: 500

# If level is locked, take screenshot and exit
- takeScreenshot: "level_03_select_state"

# Wait for mission briefing screen
- assertVisible:
    text: "MISSION BRIEFING"
    optional: true
    timeout: 10000

# Check for Canyon Run mission details
- assertVisible:
    text: "CANYON RUN"
    optional: true

- assertVisible:
    text: "ACT 2: THE SEARCH"
    optional: true

- takeScreenshot: "level_03_briefing"

# Begin mission if briefing is shown
- tapOn:
    text: "BEGIN MISSION"
    optional: true

# Wait for loading
- extendedWaitUntil:
    visible: "SYSTEMS ONLINE"
    timeout: 60000
    optional: true

- wait: 3000

- takeScreenshot: "level_03_vehicle_start"

# Vehicle controls - steering left/right
- swipe:
    start: "10%, 70%"
    end: "5%, 70%"
    duration: 1000

- wait: 500

- swipe:
    start: "10%, 70%"
    end: "20%, 70%"
    duration: 1500

# Turret aiming
- swipe:
    start: "80%, 50%"
    end: "85%, 40%"
    duration: 1000

# Fire turret
- tapOn:
    id: "fire-button"
    optional: true

- wait: 500

- tapOn:
    id: "fire-button"
    optional: true

# Boost if available
- tapOn:
    id: "boost-button"
    optional: true

- wait: 2000

- takeScreenshot: "level_03_canyon_chase"

# Continue vehicle gameplay
- repeat:
    times: 3
    commands:
      - swipe:
          start: "10%, 70%"
          end: "15%, 65%"
          duration: 1500
      - wait: 300
      - tapOn:
          id: "fire-button"
          optional: true
      - wait: 500

- takeScreenshot: "level_03_gameplay"
