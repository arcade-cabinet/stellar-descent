# Credits Sequence E2E Test Flow
# Tests the end-game credits roll after completing the Final Escape level
# Verifies: Credits content, campaign statistics, achievement summary,
#           scroll behavior, skip/speed controls, return to menu
# Cross-platform: Web, Android, iOS

appId: "${PLATFORM == 'android' ? 'com.jbcom.stellardescent' : (PLATFORM == 'ios' ? 'com.jbcom.stellardescent' : null)}"
url: "${PLATFORM == 'web' ? 'http://localhost:8080' : null}"
tags:
  - credits
  - endgame
  - ui
  - campaign-complete
  - extended
name: "Credits Sequence - Campaign Completion"

---
- launchApp:
    clearState: true

# Wait for main menu
- extendedWaitUntil:
    visible: "NEW GAME"
    timeout: 30000

- takeScreenshot: "credits_test_start"

# ============================================================================
# NAVIGATE TO CREDITS (via level select or direct)
# ============================================================================

# Note: Credits are triggered after completing Final Escape (Chapter 10)
# This test assumes the game state has campaign completion, or we test
# the credits UI elements when accessible

- tapOn:
    text: "SELECT MISSION"
    optional: true

- wait: 1000

# Check if campaign is complete (Final Escape marked completed)
- assertVisible:
    text: "FINAL ESCAPE"
    optional: true

- takeScreenshot: "credits_level_select_check"

# Look for a credits button or completed campaign indicator
- tapOn:
    text: "CREDITS"
    optional: true

- tapOn:
    text: "VIEW CREDITS"
    optional: true

- wait: 1000

# ============================================================================
# CREDITS SEQUENCE - TITLE SECTION
# ============================================================================

# Wait for credits to begin
- extendedWaitUntil:
    visible: "STELLAR DESCENT"
    timeout: 30000
    optional: true

- takeScreenshot: "credits_title_start"

# Verify game title
- assertVisible:
    text: "STELLAR DESCENT"
    optional: true

# Verify subtitle
- assertVisible:
    text: "7TH DROP"
    optional: true

- takeScreenshot: "credits_game_title"

# ============================================================================
# CREDITS - CREATOR SECTION
# ============================================================================

# Verify creator credits appear
- assertVisible:
    text: "Created By"
    optional: true
    timeout: 30000

- assertVisible:
    text: "Jeff Bogaty"
    optional: true

- takeScreenshot: "credits_creator"

# ============================================================================
# CREDITS - MUSIC SECTION
# ============================================================================

# Verify music credits
- assertVisible:
    text: "Music"
    optional: true
    timeout: 30000

- assertVisible:
    text: "Clement Panchout"
    optional: true

- takeScreenshot: "credits_music"

# ============================================================================
# CREDITS - CAMPAIGN STATISTICS SECTION
# ============================================================================

# Verify campaign statistics heading
- assertVisible:
    text: "Campaign Statistics"
    optional: true
    timeout: 30000

- takeScreenshot: "credits_stats_header"

# Verify statistics fields
- assertVisible:
    text: "Total Play Time"
    optional: true

- assertVisible:
    text: "Hostiles Eliminated"
    optional: true

- assertVisible:
    text: "Overall Accuracy"
    optional: true

- assertVisible:
    text: "Deaths"
    optional: true

- assertVisible:
    text: "Favorite Weapon"
    optional: true

- takeScreenshot: "credits_campaign_statistics"

# ============================================================================
# CREDITS - ACHIEVEMENT SUMMARY SECTION
# ============================================================================

# Verify achievement summary
- assertVisible:
    text: "Achievement Summary"
    optional: true
    timeout: 30000

- assertVisible:
    text: "Achievements Unlocked"
    optional: true

- takeScreenshot: "credits_achievement_summary"

# ============================================================================
# CREDITS - TECHNOLOGY SECTION
# ============================================================================

# Verify technology stack credits
- assertVisible:
    text: "Powered By"
    optional: true
    timeout: 30000

- assertVisible:
    text: "React"
    optional: true

- assertVisible:
    text: "Babylon.js"
    optional: true

- assertVisible:
    text: "TypeScript"
    optional: true

- takeScreenshot: "credits_technology"

# ============================================================================
# CREDITS - SPECIAL THANKS SECTION
# ============================================================================

# Verify special thanks
- assertVisible:
    text: "Special Thanks"
    optional: true
    timeout: 30000

- assertVisible:
    text: "Anthropic Claude"
    optional: true

- takeScreenshot: "credits_special_thanks"

# ============================================================================
# CREDITS - FINAL MESSAGE
# ============================================================================

# Verify final thank you message
- assertVisible:
    text: "THANK YOU FOR PLAYING"
    optional: true
    timeout: 60000

- assertVisible:
    text: "Semper Descensus"
    optional: true

- takeScreenshot: "credits_final_message"

# ============================================================================
# CREDITS CONTROLS
# ============================================================================

# Verify control buttons are present
- assertVisible:
    text: "SKIP"
    optional: true

- assertVisible:
    text: "SPEED UP"
    optional: true

- assertVisible:
    text: "PAUSE"
    optional: true

- takeScreenshot: "credits_controls_visible"

# ============================================================================
# TEST SPEED UP FUNCTIONALITY
# ============================================================================

- tapOn:
    text: "SPEED UP"
    optional: true

- wait: 2000

- takeScreenshot: "credits_speed_up_active"

# ============================================================================
# TEST PAUSE FUNCTIONALITY
# ============================================================================

- tapOn:
    text: "PAUSE"
    optional: true

- wait: 1000

- takeScreenshot: "credits_paused"

# Resume by tapping pause again
- tapOn:
    text: "PAUSE"
    optional: true

- tapOn:
    text: "RESUME"
    optional: true

- wait: 1000

- takeScreenshot: "credits_resumed"

# ============================================================================
# END SCREEN OPTIONS
# ============================================================================

# Wait for end buttons to appear
- assertVisible:
    text: "RETURN TO MENU"
    optional: true
    timeout: 60000

- assertVisible:
    text: "NEW GAME+"
    optional: true

- takeScreenshot: "credits_end_buttons"

# ============================================================================
# TEST SKIP FUNCTIONALITY
# ============================================================================

# Go back to beginning to test skip
- tapOn:
    text: "RETURN TO MENU"
    optional: true

- wait: 2000

# Navigate back to credits
- tapOn:
    text: "SELECT MISSION"
    optional: true

- wait: 500

- tapOn:
    text: "CREDITS"
    optional: true

- tapOn:
    text: "VIEW CREDITS"
    optional: true

- wait: 2000

# Test skip button
- tapOn:
    text: "SKIP"
    optional: true

- wait: 2000

- takeScreenshot: "credits_after_skip"

# Should jump to end screen
- assertVisible:
    text: "RETURN TO MENU"
    optional: true
    timeout: 10000

# ============================================================================
# RETURN TO MENU
# ============================================================================

- tapOn:
    text: "RETURN TO MENU"
    optional: true

- wait: 2000

# Verify returned to main menu
- assertVisible:
    text: "NEW GAME"
    optional: true
    timeout: 10000

- takeScreenshot: "credits_returned_to_menu"

# ============================================================================
# TEST NEW GAME+ OPTION
# ============================================================================

# Navigate back to credits
- tapOn:
    text: "SELECT MISSION"
    optional: true

- wait: 500

- tapOn:
    text: "CREDITS"
    optional: true

- tapOn:
    text: "VIEW CREDITS"
    optional: true

- wait: 2000

# Skip to end
- tapOn:
    text: "SKIP"
    optional: true

- wait: 2000

# Test New Game+ button
- assertVisible:
    text: "NEW GAME+"
    optional: true
    timeout: 10000

- tapOn:
    text: "NEW GAME+"
    optional: true

- wait: 2000

- takeScreenshot: "credits_new_game_plus"

# Verify New Game+ starts or shows confirmation
- assertVisible:
    text: "NEW GAME"
    optional: true
    timeout: 10000

- assertVisible:
    text: "MISSION"
    optional: true

- takeScreenshot: "credits_new_game_plus_result"
