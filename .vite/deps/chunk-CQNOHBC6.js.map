{
  "version": 3,
  "sources": ["../../node_modules/.pnpm/@babylonjs+core@8.49.1/dev/core/src/States/alphaCullingState.ts", "../../node_modules/.pnpm/@babylonjs+core@8.49.1/dev/core/src/Materials/Textures/textureSampler.ts", "../../node_modules/.pnpm/@babylonjs+core@8.49.1/dev/core/src/Materials/Textures/internalTexture.ts", "../../node_modules/.pnpm/@babylonjs+core@8.49.1/dev/core/src/States/depthCullingState.ts", "../../node_modules/.pnpm/@babylonjs+core@8.49.1/dev/core/src/States/stencilStateComposer.ts", "../../node_modules/.pnpm/@babylonjs+core@8.49.1/dev/core/src/States/stencilState.ts", "../../node_modules/.pnpm/@babylonjs+core@8.49.1/dev/core/src/Engines/abstractEngine.ts"],
  "sourcesContent": ["import { Constants } from \"core/Engines/constants\";\r\nimport type { Nullable } from \"../types\";\r\n\r\n/**\r\n * @internal\r\n **/\r\nexport class AlphaState {\r\n    public _blendFunctionParameters = new Array<Nullable<number>>(4 * 8);\r\n    public _blendEquationParameters = new Array<Nullable<number>>(2 * 8);\r\n    public _blendConstants = new Array<Nullable<number>>(4);\r\n    public _isBlendConstantsDirty = false;\r\n\r\n    public _alphaBlend = Array(8).fill(false);\r\n    public _numTargetEnabled = 0;\r\n\r\n    private _isAlphaBlendDirty = false;\r\n    private _isBlendFunctionParametersDirty = false;\r\n    private _isBlendEquationParametersDirty = false;\r\n\r\n    /**\r\n     * Initializes the state.\r\n     * @param _supportBlendParametersPerTarget - Whether blend parameters per target is supported\r\n     */\r\n    public constructor(private _supportBlendParametersPerTarget: boolean) {\r\n        this.reset();\r\n    }\r\n\r\n    public get isDirty(): boolean {\r\n        return this._isAlphaBlendDirty || this._isBlendFunctionParametersDirty || this._isBlendEquationParametersDirty;\r\n    }\r\n\r\n    public get alphaBlend(): boolean {\r\n        return this._numTargetEnabled > 0;\r\n    }\r\n\r\n    public set alphaBlend(value: boolean) {\r\n        this.setAlphaBlend(value);\r\n    }\r\n\r\n    public setAlphaBlend(value: boolean, targetIndex: number = 0): void {\r\n        if (this._alphaBlend[targetIndex] === value) {\r\n            return;\r\n        }\r\n\r\n        if (value) {\r\n            this._numTargetEnabled++;\r\n        } else {\r\n            this._numTargetEnabled--;\r\n        }\r\n\r\n        this._alphaBlend[targetIndex] = value;\r\n        this._isAlphaBlendDirty = true;\r\n    }\r\n\r\n    public setAlphaBlendConstants(r: number, g: number, b: number, a: number): void {\r\n        if (this._blendConstants[0] === r && this._blendConstants[1] === g && this._blendConstants[2] === b && this._blendConstants[3] === a) {\r\n            return;\r\n        }\r\n\r\n        this._blendConstants[0] = r;\r\n        this._blendConstants[1] = g;\r\n        this._blendConstants[2] = b;\r\n        this._blendConstants[3] = a;\r\n\r\n        this._isBlendConstantsDirty = true;\r\n    }\r\n\r\n    public setAlphaBlendFunctionParameters(srcRGBFactor: number, dstRGBFactor: number, srcAlphaFactor: number, dstAlphaFactor: number, targetIndex: number = 0): void {\r\n        const offset = targetIndex * 4;\r\n\r\n        if (\r\n            this._blendFunctionParameters[offset + 0] === srcRGBFactor &&\r\n            this._blendFunctionParameters[offset + 1] === dstRGBFactor &&\r\n            this._blendFunctionParameters[offset + 2] === srcAlphaFactor &&\r\n            this._blendFunctionParameters[offset + 3] === dstAlphaFactor\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        this._blendFunctionParameters[offset + 0] = srcRGBFactor;\r\n        this._blendFunctionParameters[offset + 1] = dstRGBFactor;\r\n        this._blendFunctionParameters[offset + 2] = srcAlphaFactor;\r\n        this._blendFunctionParameters[offset + 3] = dstAlphaFactor;\r\n\r\n        this._isBlendFunctionParametersDirty = true;\r\n    }\r\n\r\n    public setAlphaEquationParameters(rgbEquation: number, alphaEquation: number, targetIndex: number = 0): void {\r\n        const offset = targetIndex * 2;\r\n\r\n        if (this._blendEquationParameters[offset + 0] === rgbEquation && this._blendEquationParameters[offset + 1] === alphaEquation) {\r\n            return;\r\n        }\r\n\r\n        this._blendEquationParameters[offset + 0] = rgbEquation;\r\n        this._blendEquationParameters[offset + 1] = alphaEquation;\r\n\r\n        this._isBlendEquationParametersDirty = true;\r\n    }\r\n\r\n    public reset() {\r\n        this._alphaBlend.fill(false);\r\n        this._numTargetEnabled = 0;\r\n        this._blendFunctionParameters.fill(null);\r\n        this._blendEquationParameters.fill(null);\r\n\r\n        this._blendConstants[0] = null;\r\n        this._blendConstants[1] = null;\r\n        this._blendConstants[2] = null;\r\n        this._blendConstants[3] = null;\r\n\r\n        this._isAlphaBlendDirty = true;\r\n        this._isBlendFunctionParametersDirty = false;\r\n        this._isBlendEquationParametersDirty = false;\r\n        this._isBlendConstantsDirty = false;\r\n    }\r\n\r\n    public apply(gl: WebGLRenderingContext, numTargets: number = 1): void {\r\n        if (!this.isDirty) {\r\n            return;\r\n        }\r\n\r\n        // Constants\r\n        if (this._isBlendConstantsDirty) {\r\n            gl.blendColor(<number>this._blendConstants[0], <number>this._blendConstants[1], <number>this._blendConstants[2], <number>this._blendConstants[3]);\r\n            this._isBlendConstantsDirty = false;\r\n        }\r\n\r\n        if (numTargets === 1 || !this._supportBlendParametersPerTarget) {\r\n            // Single target or no support for per-target parameters\r\n            if (this._isAlphaBlendDirty) {\r\n                if (this._alphaBlend[0]) {\r\n                    gl.enable(gl.BLEND);\r\n                } else {\r\n                    gl.disable(gl.BLEND);\r\n                }\r\n                this._isAlphaBlendDirty = false;\r\n            }\r\n\r\n            if (this._isBlendFunctionParametersDirty) {\r\n                gl.blendFuncSeparate(\r\n                    <number>this._blendFunctionParameters[0],\r\n                    <number>this._blendFunctionParameters[1],\r\n                    <number>this._blendFunctionParameters[2],\r\n                    <number>this._blendFunctionParameters[3]\r\n                );\r\n                this._isBlendFunctionParametersDirty = false;\r\n            }\r\n\r\n            if (this._isBlendEquationParametersDirty) {\r\n                gl.blendEquationSeparate(<number>this._blendEquationParameters[0], <number>this._blendEquationParameters[1]);\r\n                this._isBlendEquationParametersDirty = false;\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Multi-target\r\n        const gl2 = gl as WebGL2RenderingContext;\r\n\r\n        // Alpha blend\r\n        if (this._isAlphaBlendDirty) {\r\n            for (let i = 0; i < numTargets; i++) {\r\n                const index = i < this._numTargetEnabled ? i : 0;\r\n                if (this._alphaBlend[index]) {\r\n                    gl2.enableIndexed(gl.BLEND, i);\r\n                } else {\r\n                    gl2.disableIndexed(gl.BLEND, i);\r\n                }\r\n            }\r\n\r\n            this._isAlphaBlendDirty = false;\r\n        }\r\n\r\n        // Alpha function\r\n        if (this._isBlendFunctionParametersDirty) {\r\n            for (let i = 0; i < numTargets; i++) {\r\n                const offset = i < this._numTargetEnabled ? i * 4 : 0;\r\n                gl2.blendFuncSeparateIndexed(\r\n                    i,\r\n                    <number>this._blendFunctionParameters[offset + 0],\r\n                    <number>this._blendFunctionParameters[offset + 1],\r\n                    <number>this._blendFunctionParameters[offset + 2],\r\n                    <number>this._blendFunctionParameters[offset + 3]\r\n                );\r\n            }\r\n            this._isBlendFunctionParametersDirty = false;\r\n        }\r\n\r\n        // Alpha equation\r\n        if (this._isBlendEquationParametersDirty) {\r\n            for (let i = 0; i < numTargets; i++) {\r\n                const offset = i < this._numTargetEnabled ? i * 2 : 0;\r\n                gl2.blendEquationSeparateIndexed(i, <number>this._blendEquationParameters[offset + 0], <number>this._blendEquationParameters[offset + 1]);\r\n            }\r\n            this._isBlendEquationParametersDirty = false;\r\n        }\r\n    }\r\n\r\n    public setAlphaMode(mode: number, targetIndex: number) {\r\n        let equation = Constants.GL_ALPHA_EQUATION_ADD;\r\n\r\n        switch (mode) {\r\n            case Constants.ALPHA_DISABLE:\r\n                break;\r\n            case Constants.ALPHA_PREMULTIPLIED:\r\n                this.setAlphaBlendFunctionParameters(1, Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA, 1, 1, targetIndex);\r\n                break;\r\n            case Constants.ALPHA_PREMULTIPLIED_PORTERDUFF:\r\n                this.setAlphaBlendFunctionParameters(1, Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA, 1, Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA, targetIndex);\r\n                break;\r\n            case Constants.ALPHA_COMBINE:\r\n                this.setAlphaBlendFunctionParameters(Constants.GL_ALPHA_FUNCTION_SRC_ALPHA, Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA, 1, 1, targetIndex);\r\n                break;\r\n            case Constants.ALPHA_ONEONE:\r\n                this.setAlphaBlendFunctionParameters(1, 1, 0, 1, targetIndex);\r\n                break;\r\n            case Constants.ALPHA_ADD:\r\n                this.setAlphaBlendFunctionParameters(Constants.GL_ALPHA_FUNCTION_SRC_ALPHA, 1, 0, 1, targetIndex);\r\n                break;\r\n            case Constants.ALPHA_SUBTRACT:\r\n                this.setAlphaBlendFunctionParameters(0, Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR, 1, 1, targetIndex);\r\n                break;\r\n            case Constants.ALPHA_MULTIPLY:\r\n                this.setAlphaBlendFunctionParameters(Constants.GL_ALPHA_FUNCTION_DST_COLOR, 0, 1, 1, targetIndex);\r\n                break;\r\n            case Constants.ALPHA_MAXIMIZED:\r\n                this.setAlphaBlendFunctionParameters(Constants.GL_ALPHA_FUNCTION_SRC_ALPHA, Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR, 1, 1, targetIndex);\r\n                break;\r\n            case Constants.ALPHA_INTERPOLATE:\r\n                this.setAlphaBlendFunctionParameters(\r\n                    Constants.GL_ALPHA_FUNCTION_CONSTANT_COLOR,\r\n                    Constants.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR,\r\n                    Constants.GL_ALPHA_FUNCTION_CONSTANT_ALPHA,\r\n                    Constants.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA,\r\n                    targetIndex\r\n                );\r\n                break;\r\n            case Constants.ALPHA_SCREENMODE:\r\n                this.setAlphaBlendFunctionParameters(1, Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR, 1, Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA, targetIndex);\r\n                break;\r\n            case Constants.ALPHA_ONEONE_ONEONE:\r\n                this.setAlphaBlendFunctionParameters(1, 1, 1, 1, targetIndex);\r\n                break;\r\n            case Constants.ALPHA_ALPHATOCOLOR:\r\n                this.setAlphaBlendFunctionParameters(Constants.GL_ALPHA_FUNCTION_DST_ALPHA, 1, 0, 0, targetIndex);\r\n                break;\r\n            case Constants.ALPHA_REVERSEONEMINUS:\r\n                this.setAlphaBlendFunctionParameters(\r\n                    Constants.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR,\r\n                    Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR,\r\n                    Constants.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA,\r\n                    Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA,\r\n                    targetIndex\r\n                );\r\n                break;\r\n            case Constants.ALPHA_SRC_DSTONEMINUSSRCALPHA:\r\n                this.setAlphaBlendFunctionParameters(1, Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA, 1, Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA, targetIndex);\r\n                break;\r\n            case Constants.ALPHA_ONEONE_ONEZERO:\r\n                this.setAlphaBlendFunctionParameters(1, 1, 1, 0, targetIndex);\r\n                break;\r\n            case Constants.ALPHA_EXCLUSION:\r\n                this.setAlphaBlendFunctionParameters(Constants.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR, Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR, 0, 1, targetIndex);\r\n                break;\r\n            case Constants.ALPHA_LAYER_ACCUMULATE:\r\n                // Same as ALPHA_COMBINE but accumulates (1 - alpha) values in the alpha channel for a later readout in order independant transparency\r\n                this.setAlphaBlendFunctionParameters(\r\n                    Constants.GL_ALPHA_FUNCTION_SRC_ALPHA,\r\n                    Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA,\r\n                    1,\r\n                    Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA,\r\n                    targetIndex\r\n                );\r\n                break;\r\n            case Constants.ALPHA_MIN:\r\n                this.setAlphaBlendFunctionParameters(1, 1, 1, 1, targetIndex);\r\n                equation = Constants.GL_ALPHA_EQUATION_MIN;\r\n                break;\r\n            case Constants.ALPHA_MAX:\r\n                this.setAlphaBlendFunctionParameters(1, 1, 1, 1, targetIndex);\r\n                equation = Constants.GL_ALPHA_EQUATION_MAX;\r\n                break;\r\n            case Constants.ALPHA_DUAL_SRC0_ADD_SRC1xDST:\r\n                this.setAlphaBlendFunctionParameters(1, Constants.GL_ALPHA_FUNCTION_SRC1_COLOR, 0, 1, targetIndex);\r\n                break;\r\n        }\r\n\r\n        this.setAlphaEquationParameters(equation, equation, targetIndex);\r\n    }\r\n}\r\n", "import { Constants } from \"../../Engines/constants\";\r\nimport type { Nullable } from \"../../types\";\r\n\r\n/**\r\n * Class used to store a texture sampler data\r\n */\r\nexport class TextureSampler {\r\n    /**\r\n     * Gets the sampling mode of the texture\r\n     */\r\n    public samplingMode: number = -1;\r\n\r\n    /**\r\n     * | Value | Type               | Description |\r\n     * | ----- | ------------------ | ----------- |\r\n     * | 0     | CLAMP_ADDRESSMODE  |             |\r\n     * | 1     | WRAP_ADDRESSMODE   |             |\r\n     * | 2     | MIRROR_ADDRESSMODE |             |\r\n     */\r\n    public get wrapU() {\r\n        return this._cachedWrapU;\r\n    }\r\n\r\n    public set wrapU(value: Nullable<number>) {\r\n        this._cachedWrapU = value;\r\n    }\r\n\r\n    /**\r\n     * | Value | Type               | Description |\r\n     * | ----- | ------------------ | ----------- |\r\n     * | 0     | CLAMP_ADDRESSMODE  |             |\r\n     * | 1     | WRAP_ADDRESSMODE   |             |\r\n     * | 2     | MIRROR_ADDRESSMODE |             |\r\n     */\r\n    public get wrapV() {\r\n        return this._cachedWrapV;\r\n    }\r\n\r\n    public set wrapV(value: Nullable<number>) {\r\n        this._cachedWrapV = value;\r\n    }\r\n\r\n    /**\r\n     * | Value | Type               | Description |\r\n     * | ----- | ------------------ | ----------- |\r\n     * | 0     | CLAMP_ADDRESSMODE  |             |\r\n     * | 1     | WRAP_ADDRESSMODE   |             |\r\n     * | 2     | MIRROR_ADDRESSMODE |             |\r\n     */\r\n    public get wrapR() {\r\n        return this._cachedWrapR;\r\n    }\r\n\r\n    public set wrapR(value: Nullable<number>) {\r\n        this._cachedWrapR = value;\r\n    }\r\n\r\n    /**\r\n     * With compliant hardware and browser (supporting anisotropic filtering)\r\n     * this defines the level of anisotropic filtering in the texture.\r\n     * The higher the better but the slower.\r\n     */\r\n    public get anisotropicFilteringLevel() {\r\n        return this._cachedAnisotropicFilteringLevel;\r\n    }\r\n\r\n    public set anisotropicFilteringLevel(value: Nullable<number>) {\r\n        this._cachedAnisotropicFilteringLevel = value;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets the comparison function (Constants.LESS, Constants.EQUAL, etc). Set 0 to not use a comparison function\r\n     */\r\n    public get comparisonFunction() {\r\n        return this._comparisonFunction;\r\n    }\r\n\r\n    public set comparisonFunction(value: number) {\r\n        this._comparisonFunction = value;\r\n    }\r\n\r\n    protected _useMipMaps: Nullable<boolean> = true;\r\n    /**\r\n     * Indicates to use the mip maps (if available on the texture).\r\n     * Thanks to this flag, you can instruct the sampler to not sample the mipmaps even if they exist (and if the sampling mode is set to a value that normally samples the mipmaps!)\r\n     */\r\n    public get useMipMaps() {\r\n        return this._useMipMaps;\r\n    }\r\n\r\n    public set useMipMaps(value: Nullable<boolean>) {\r\n        this._useMipMaps = value;\r\n    }\r\n\r\n    /** @internal */\r\n    public _cachedWrapU: Nullable<number> = null;\r\n\r\n    /** @internal */\r\n    public _cachedWrapV: Nullable<number> = null;\r\n\r\n    /** @internal */\r\n    public _cachedWrapR: Nullable<number> = null;\r\n\r\n    /** @internal */\r\n    public _cachedAnisotropicFilteringLevel: Nullable<number> = null;\r\n\r\n    /** @internal */\r\n    public _comparisonFunction: number = 0;\r\n\r\n    /**\r\n     * General label used for debugging or storing a name.\r\n     */\r\n    public label?: string;\r\n\r\n    /**\r\n     * Creates a Sampler instance\r\n     */\r\n    constructor() {}\r\n\r\n    /**\r\n     * Sets all the parameters of the sampler\r\n     * @param wrapU u address mode (default: TEXTURE_WRAP_ADDRESSMODE)\r\n     * @param wrapV v address mode (default: TEXTURE_WRAP_ADDRESSMODE)\r\n     * @param wrapR r address mode (default: TEXTURE_WRAP_ADDRESSMODE)\r\n     * @param anisotropicFilteringLevel anisotropic level (default: 1)\r\n     * @param samplingMode sampling mode (default: Constants.TEXTURE_BILINEAR_SAMPLINGMODE)\r\n     * @param comparisonFunction comparison function (default: 0 - no comparison function)\r\n     * @returns the current sampler instance\r\n     */\r\n    public setParameters(\r\n        wrapU = Constants.TEXTURE_WRAP_ADDRESSMODE,\r\n        wrapV = Constants.TEXTURE_WRAP_ADDRESSMODE,\r\n        wrapR = Constants.TEXTURE_WRAP_ADDRESSMODE,\r\n        anisotropicFilteringLevel = 1,\r\n        samplingMode = Constants.TEXTURE_BILINEAR_SAMPLINGMODE,\r\n        comparisonFunction = 0\r\n    ): TextureSampler {\r\n        this._cachedWrapU = wrapU;\r\n        this._cachedWrapV = wrapV;\r\n        this._cachedWrapR = wrapR;\r\n        this._cachedAnisotropicFilteringLevel = anisotropicFilteringLevel;\r\n        this.samplingMode = samplingMode;\r\n        this._comparisonFunction = comparisonFunction;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Compares this sampler with another one\r\n     * @param other sampler to compare with\r\n     * @returns true if the samplers have the same parametres, else false\r\n     */\r\n    public compareSampler(other: TextureSampler): boolean {\r\n        return (\r\n            this._cachedWrapU === other._cachedWrapU &&\r\n            this._cachedWrapV === other._cachedWrapV &&\r\n            this._cachedWrapR === other._cachedWrapR &&\r\n            this._cachedAnisotropicFilteringLevel === other._cachedAnisotropicFilteringLevel &&\r\n            this.samplingMode === other.samplingMode &&\r\n            this._comparisonFunction === other._comparisonFunction &&\r\n            this._useMipMaps === other._useMipMaps\r\n        );\r\n    }\r\n}\r\n", "import { Observable } from \"../../Misc/observable\";\r\nimport type { ImageSource, Nullable, int } from \"../../types\";\r\nimport type { ICanvas, ICanvasRenderingContext } from \"../../Engines/ICanvas\";\r\nimport type { IHardwareTextureWrapper } from \"./hardwareTextureWrapper\";\r\nimport { TextureSampler } from \"./textureSampler\";\r\n\r\nimport type { AbstractEngine } from \"../../Engines/abstractEngine\";\r\nimport type { BaseTexture } from \"../../Materials/Textures/baseTexture\";\r\nimport type { SphericalPolynomial } from \"../../Maths/sphericalPolynomial\";\r\n\r\n/**\r\n * Defines the source of the internal texture\r\n */\r\nexport const enum InternalTextureSource {\r\n    /**\r\n     * The source of the texture data is unknown\r\n     */\r\n    Unknown,\r\n    /**\r\n     * Texture data comes from an URL\r\n     */\r\n    Url,\r\n    /**\r\n     * Texture data is only used for temporary storage\r\n     */\r\n    Temp,\r\n    /**\r\n     * Texture data comes from raw data (ArrayBuffer)\r\n     */\r\n    Raw,\r\n    /**\r\n     * Texture content is dynamic (video or dynamic texture)\r\n     */\r\n    Dynamic,\r\n    /**\r\n     * Texture content is generated by rendering to it\r\n     */\r\n    RenderTarget,\r\n    /**\r\n     * Texture content is part of a multi render target process\r\n     */\r\n    MultiRenderTarget,\r\n    /**\r\n     * Texture data comes from a cube data file\r\n     */\r\n    Cube,\r\n    /**\r\n     * Texture data comes from a raw cube data\r\n     */\r\n    CubeRaw,\r\n    /**\r\n     * Texture data come from a prefiltered cube data file\r\n     */\r\n    CubePrefiltered,\r\n    /**\r\n     * Texture content is raw 3D data\r\n     */\r\n    Raw3D,\r\n    /**\r\n     * Texture content is raw 2D array data\r\n     */\r\n    Raw2DArray,\r\n    /**\r\n     * Texture content is a depth/stencil texture\r\n     */\r\n    DepthStencil,\r\n    /**\r\n     * Texture data comes from a raw cube data encoded with RGBD\r\n     */\r\n    CubeRawRGBD,\r\n    /**\r\n     * Texture content is a depth texture\r\n     */\r\n    Depth,\r\n}\r\n\r\n/**\r\n * Class used to store data associated with WebGL texture data for the engine\r\n * This class should not be used directly\r\n */\r\nexport class InternalTexture extends TextureSampler {\r\n    /**\r\n     * Defines if the texture is ready\r\n     */\r\n    public isReady: boolean = false;\r\n    /**\r\n     * Defines if the texture is a cube texture\r\n     */\r\n    public isCube: boolean = false;\r\n    /**\r\n     * Defines if the texture contains 3D data\r\n     */\r\n    public is3D: boolean = false;\r\n    /**\r\n     * Defines if the texture contains 2D array data\r\n     */\r\n    public is2DArray: boolean = false;\r\n    /**\r\n     * Defines if the texture contains multiview data\r\n     */\r\n    public isMultiview: boolean = false;\r\n    /**\r\n     * Gets the URL used to load this texture\r\n     */\r\n    public url: string = \"\";\r\n    /** @internal */\r\n    public _originalUrl: string; // not empty only if different from url\r\n    /**\r\n     * Gets a boolean indicating if the texture needs mipmaps generation\r\n     */\r\n    public generateMipMaps: boolean = false;\r\n\r\n    protected override _useMipMaps: Nullable<boolean> = null;\r\n    /**\r\n     * Indicates to use the mip maps (if available on the texture).\r\n     * Thanks to this flag, you can instruct the sampler to not sample the mipmaps even if they exist (and if the sampling mode is set to a value that normally samples the mipmaps!)\r\n     * If useMipMaps is null, the value of generateMipMaps is returned by the getter (for backward compatibility)\r\n     */\r\n    public override get useMipMaps() {\r\n        return this._useMipMaps === null ? this.generateMipMaps : this._useMipMaps;\r\n    }\r\n    public override set useMipMaps(value: Nullable<boolean>) {\r\n        this._useMipMaps = value;\r\n    }\r\n    /**\r\n     * Gets the number of mip levels for this texture.\r\n     * Note: This property has the correct value only if the texture was created through\r\n     * `createRawTexture` or `createRawTexture2DArray`.\r\n     */\r\n    public mipLevelCount: number = 1;\r\n    /**\r\n     * Gets the number of samples used by the texture (WebGL2+ only)\r\n     */\r\n    public samples: number = 0;\r\n    /**\r\n     * Gets the type of the texture (int, float...)\r\n     */\r\n    public type: number = -1;\r\n    /**\r\n     * Gets the format of the texture (RGB, RGBA...)\r\n     */\r\n    public format: number = -1;\r\n    /**\r\n     * Observable called when the texture is loaded\r\n     */\r\n    public onLoadedObservable = new Observable<InternalTexture>();\r\n    /**\r\n     * Observable called when the texture load is raising an error\r\n     */\r\n    public onErrorObservable = new Observable<Partial<{ message: string; exception: any }>>();\r\n    /**\r\n     * If this callback is defined it will be called instead of the default _rebuild function\r\n     */\r\n    public onRebuildCallback: Nullable<\r\n        (internalTexture: InternalTexture) => {\r\n            proxy: Nullable<InternalTexture | Promise<InternalTexture>>;\r\n            isReady: boolean;\r\n            isAsync: boolean;\r\n        }\r\n    > = null;\r\n    /**\r\n     * Gets the width of the texture\r\n     */\r\n    public width: number = 0;\r\n    /**\r\n     * Gets the height of the texture\r\n     */\r\n    public height: number = 0;\r\n    /**\r\n     * Gets the depth of the texture\r\n     */\r\n    public depth: number = 0;\r\n    /**\r\n     * Gets the initial width of the texture (It could be rescaled if the current system does not support non power of two textures)\r\n     */\r\n    public baseWidth: number = 0;\r\n    /**\r\n     * Gets the initial height of the texture (It could be rescaled if the current system does not support non power of two textures)\r\n     */\r\n    public baseHeight: number = 0;\r\n    /**\r\n     * Gets the initial depth of the texture (It could be rescaled if the current system does not support non power of two textures)\r\n     */\r\n    public baseDepth: number = 0;\r\n    /**\r\n     * Gets a boolean indicating if the texture is inverted on Y axis\r\n     */\r\n    public invertY: boolean = false;\r\n\r\n    // Private\r\n    /** @internal */\r\n    public _invertVScale = false;\r\n    /** @internal */\r\n    public _associatedChannel = -1;\r\n    /** @internal */\r\n    public _source = InternalTextureSource.Unknown;\r\n    /** @internal */\r\n    public _buffer: Nullable<string | ArrayBuffer | ArrayBufferView | HTMLImageElement | Blob | ImageBitmap> = null;\r\n    /** @internal */\r\n    public _bufferView: Nullable<ArrayBufferView> = null;\r\n    /** @internal */\r\n    public _bufferViewArray: Nullable<ArrayBufferView[]> = null;\r\n    /** @internal */\r\n    public _bufferViewArrayArray: Nullable<ArrayBufferView[][]> = null;\r\n    /** @internal */\r\n    public _size: number = 0;\r\n    /** @internal */\r\n    public _extension: string = \"\";\r\n    /** @internal */\r\n    public _files: Nullable<string[]> = null;\r\n    /** @internal */\r\n    public _workingCanvas: Nullable<ICanvas> = null;\r\n    /** @internal */\r\n    public _workingContext: Nullable<ICanvasRenderingContext> = null;\r\n    /** @internal */\r\n    public _cachedCoordinatesMode: Nullable<number> = null;\r\n    /** @internal */\r\n    public _isDisabled: boolean = false;\r\n    /** @internal */\r\n    public _compression: Nullable<string> = null;\r\n    /** @internal */\r\n    public _sphericalPolynomial: Nullable<SphericalPolynomial> = null;\r\n    /** @internal */\r\n    public _sphericalPolynomialPromise: Nullable<Promise<SphericalPolynomial>> = null;\r\n    /** @internal */\r\n    public _sphericalPolynomialComputed = false;\r\n    /** @internal */\r\n    public _lodGenerationScale: number = 0;\r\n    /** @internal */\r\n    public _lodGenerationOffset: number = 0;\r\n    /** @internal */\r\n    public _useSRGBBuffer: boolean = false;\r\n    /** @internal */\r\n    public _creationFlags: number = 0;\r\n    /** @internal */\r\n    public _originalFormat?: number;\r\n\r\n    // The following three fields helps sharing generated fixed LODs for texture filtering\r\n    // In environment not supporting the textureLOD extension like EDGE. They are for internal use only.\r\n    // They are at the level of the gl texture to benefit from the cache.\r\n    /** @internal */\r\n    public _lodTextureHigh: Nullable<BaseTexture> = null;\r\n    /** @internal */\r\n    public _lodTextureMid: Nullable<BaseTexture> = null;\r\n    /** @internal */\r\n    public _lodTextureLow: Nullable<BaseTexture> = null;\r\n    /** @internal */\r\n    public _isRGBD: boolean = false;\r\n\r\n    /** @internal */\r\n    public _linearSpecularLOD: boolean = false;\r\n    /** @internal */\r\n    public _irradianceTexture: Nullable<BaseTexture> = null;\r\n\r\n    /** @internal */\r\n    public _hardwareTexture: Nullable<IHardwareTextureWrapper> = null;\r\n\r\n    /** @internal */\r\n    public _maxLodLevel: Nullable<number> = null;\r\n\r\n    /** @internal */\r\n    public _references: number = 1;\r\n\r\n    /** @internal */\r\n    public _gammaSpace: Nullable<boolean> = null;\r\n\r\n    /** @internal */\r\n    public _premulAlpha = false;\r\n\r\n    /** @internal */\r\n    public _dynamicTextureSource: Nullable<ImageSource> = null;\r\n\r\n    /** @internal */\r\n    public _autoMSAAManagement = false;\r\n\r\n    private _engine: AbstractEngine;\r\n    private _uniqueId: number;\r\n\r\n    /** @internal */\r\n    public static _Counter = 0;\r\n\r\n    /** Gets the unique id of the internal texture */\r\n    public get uniqueId() {\r\n        return this._uniqueId;\r\n    }\r\n\r\n    /** @internal */\r\n    public _setUniqueId(id: number) {\r\n        this._uniqueId = id;\r\n    }\r\n\r\n    /**\r\n     * Gets the Engine the texture belongs to.\r\n     * @returns The babylon engine\r\n     */\r\n    public getEngine(): AbstractEngine {\r\n        return this._engine;\r\n    }\r\n\r\n    /**\r\n     * Gets the data source type of the texture\r\n     */\r\n    public get source(): InternalTextureSource {\r\n        return this._source;\r\n    }\r\n\r\n    /**\r\n     * Creates a new InternalTexture\r\n     * @param engine defines the engine to use\r\n     * @param source defines the type of data that will be used\r\n     * @param delayAllocation if the texture allocation should be delayed (default: false)\r\n     */\r\n    constructor(engine: AbstractEngine, source: InternalTextureSource, delayAllocation = false) {\r\n        super();\r\n\r\n        this._engine = engine;\r\n        this._source = source;\r\n        this._uniqueId = InternalTexture._Counter++;\r\n\r\n        if (!delayAllocation) {\r\n            this._hardwareTexture = engine._createHardwareTexture();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Increments the number of references (ie. the number of Texture that point to it)\r\n     */\r\n    public incrementReferences(): void {\r\n        this._references++;\r\n    }\r\n\r\n    /**\r\n     * Change the size of the texture (not the size of the content)\r\n     * @param width defines the new width\r\n     * @param height defines the new height\r\n     * @param depth defines the new depth (1 by default)\r\n     */\r\n    public updateSize(width: int, height: int, depth: int = 1): void {\r\n        this._engine.updateTextureDimensions(this, width, height, depth);\r\n\r\n        this.width = width;\r\n        this.height = height;\r\n        this.depth = depth;\r\n\r\n        this.baseWidth = width;\r\n        this.baseHeight = height;\r\n        this.baseDepth = depth;\r\n\r\n        this._size = width * height * depth;\r\n    }\r\n\r\n    /** @internal */\r\n    public _rebuild(): void {\r\n        this.isReady = false;\r\n        this._cachedCoordinatesMode = null;\r\n        this._cachedWrapU = null;\r\n        this._cachedWrapV = null;\r\n        this._cachedWrapR = null;\r\n        this._cachedAnisotropicFilteringLevel = null;\r\n        if (this.onRebuildCallback) {\r\n            const data = this.onRebuildCallback(this);\r\n            const swapAndSetIsReady = (proxyInternalTexture: InternalTexture) => {\r\n                proxyInternalTexture._swapAndDie(this, false);\r\n                this.isReady = data.isReady;\r\n            };\r\n            if (data.isAsync) {\r\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises, github/no-then\r\n                (data.proxy as Promise<InternalTexture>).then(swapAndSetIsReady);\r\n            } else {\r\n                swapAndSetIsReady(data.proxy as InternalTexture);\r\n            }\r\n            return;\r\n        }\r\n\r\n        let proxy: InternalTexture;\r\n        switch (this.source) {\r\n            case InternalTextureSource.Temp:\r\n                break;\r\n\r\n            case InternalTextureSource.Url:\r\n                proxy = this._engine.createTexture(\r\n                    this._originalUrl ?? this.url,\r\n                    !this.generateMipMaps,\r\n                    this.invertY,\r\n                    null,\r\n                    this.samplingMode,\r\n                    // Do not use Proxy here as it could be fully synchronous\r\n                    // and proxy would be undefined.\r\n                    (temp) => {\r\n                        temp._swapAndDie(this, false);\r\n                        this.isReady = true;\r\n                    },\r\n                    null,\r\n                    this._buffer,\r\n                    undefined,\r\n                    this.format,\r\n                    this._extension,\r\n                    undefined,\r\n                    undefined,\r\n                    undefined,\r\n                    this._useSRGBBuffer\r\n                );\r\n                return;\r\n\r\n            case InternalTextureSource.Raw:\r\n                proxy = this._engine.createRawTexture(\r\n                    this._bufferView,\r\n                    this.baseWidth,\r\n                    this.baseHeight,\r\n                    this.format,\r\n                    this.generateMipMaps,\r\n                    this.invertY,\r\n                    this.samplingMode,\r\n                    this._compression,\r\n                    this.type,\r\n                    this._creationFlags,\r\n                    this._useSRGBBuffer,\r\n                    this.mipLevelCount\r\n                );\r\n                proxy._swapAndDie(this, false);\r\n\r\n                if (this._bufferViewArray) {\r\n                    for (let mipLevel = 0; mipLevel < this._bufferViewArray.length; mipLevel++) {\r\n                        const mipData = this._bufferViewArray[mipLevel];\r\n                        if (mipData) {\r\n                            this._engine.updateRawTexture(this, mipData, this.format, this.invertY, this._compression, this.type, this._useSRGBBuffer, mipLevel);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                this.isReady = true;\r\n                break;\r\n\r\n            case InternalTextureSource.Raw3D:\r\n                proxy = this._engine.createRawTexture3D(\r\n                    this._bufferView,\r\n                    this.baseWidth,\r\n                    this.baseHeight,\r\n                    this.baseDepth,\r\n                    this.format,\r\n                    this.generateMipMaps,\r\n                    this.invertY,\r\n                    this.samplingMode,\r\n                    this._compression,\r\n                    this.type\r\n                );\r\n                proxy._swapAndDie(this, false);\r\n\r\n                this.isReady = true;\r\n                break;\r\n\r\n            case InternalTextureSource.Raw2DArray:\r\n                proxy = this._engine.createRawTexture2DArray(\r\n                    this._bufferView,\r\n                    this.baseWidth,\r\n                    this.baseHeight,\r\n                    this.baseDepth,\r\n                    this.format,\r\n                    this.generateMipMaps,\r\n                    this.invertY,\r\n                    this.samplingMode,\r\n                    this._compression,\r\n                    this.type,\r\n                    this._creationFlags,\r\n                    this.mipLevelCount\r\n                );\r\n                proxy._swapAndDie(this, false);\r\n\r\n                if (this._bufferViewArray) {\r\n                    for (let mipLevel = 0; mipLevel < this._bufferViewArray.length; mipLevel++) {\r\n                        const mipData = this._bufferViewArray[mipLevel];\r\n                        if (mipData) {\r\n                            this._engine.updateRawTexture2DArray(this, mipData, this.format, this.invertY, this._compression, this.type, mipLevel);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                this.isReady = true;\r\n                break;\r\n\r\n            case InternalTextureSource.Dynamic:\r\n                proxy = this._engine.createDynamicTexture(this.baseWidth, this.baseHeight, this.generateMipMaps, this.samplingMode);\r\n                proxy._swapAndDie(this, false);\r\n                if (this._dynamicTextureSource) {\r\n                    this._engine.updateDynamicTexture(this, this._dynamicTextureSource, this.invertY, this._premulAlpha, this.format, true);\r\n                }\r\n\r\n                // The engine will make sure to update content so no need to flag it as isReady = true\r\n                break;\r\n\r\n            case InternalTextureSource.Cube:\r\n                proxy = this._engine.createCubeTexture(\r\n                    this.url,\r\n                    null,\r\n                    this._files,\r\n                    !this.generateMipMaps,\r\n                    () => {\r\n                        proxy._swapAndDie(this, false);\r\n                        this.isReady = true;\r\n                    },\r\n                    null,\r\n                    this.format,\r\n                    this._extension,\r\n                    false,\r\n                    0,\r\n                    0,\r\n                    null,\r\n                    undefined,\r\n                    this._useSRGBBuffer,\r\n                    ArrayBuffer.isView(this._buffer) ? this._buffer : null\r\n                );\r\n                return;\r\n\r\n            case InternalTextureSource.CubeRaw:\r\n                proxy = this._engine.createRawCubeTexture(\r\n                    this._bufferViewArray,\r\n                    this.width,\r\n                    this._originalFormat ?? this.format,\r\n                    this.type,\r\n                    this.generateMipMaps,\r\n                    this.invertY,\r\n                    this.samplingMode,\r\n                    this._compression\r\n                );\r\n                proxy._swapAndDie(this, false);\r\n                this.isReady = true;\r\n                break;\r\n\r\n            case InternalTextureSource.CubeRawRGBD:\r\n                // This case is being handeled by the environment texture tools and is not a part of the rebuild process.\r\n                // To use CubeRawRGBD use updateRGBDAsync on the cube texture.\r\n                return;\r\n\r\n            case InternalTextureSource.CubePrefiltered:\r\n                proxy = this._engine.createPrefilteredCubeTexture(\r\n                    this.url,\r\n                    null,\r\n                    this._lodGenerationScale,\r\n                    this._lodGenerationOffset,\r\n                    (proxy) => {\r\n                        if (proxy) {\r\n                            proxy._swapAndDie(this, false);\r\n                        }\r\n                        this.isReady = true;\r\n                    },\r\n                    null,\r\n                    this.format,\r\n                    this._extension\r\n                );\r\n                proxy._sphericalPolynomial = this._sphericalPolynomial;\r\n                return;\r\n\r\n            case InternalTextureSource.DepthStencil:\r\n            case InternalTextureSource.Depth: {\r\n                // Will be handled at the RenderTargetWrapper level\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _swapAndDie(target: InternalTexture, swapAll = true): void {\r\n        // TODO what about refcount on target?\r\n\r\n        this._hardwareTexture?.setUsage(target._source, this.generateMipMaps, this.is2DArray, this.isCube, this.is3D, this.width, this.height, this.depth);\r\n\r\n        target._hardwareTexture = this._hardwareTexture;\r\n        if (swapAll) {\r\n            target._isRGBD = this._isRGBD;\r\n        }\r\n\r\n        if (this._lodTextureHigh) {\r\n            if (target._lodTextureHigh) {\r\n                target._lodTextureHigh.dispose();\r\n            }\r\n            target._lodTextureHigh = this._lodTextureHigh;\r\n        }\r\n\r\n        if (this._lodTextureMid) {\r\n            if (target._lodTextureMid) {\r\n                target._lodTextureMid.dispose();\r\n            }\r\n            target._lodTextureMid = this._lodTextureMid;\r\n        }\r\n\r\n        if (this._lodTextureLow) {\r\n            if (target._lodTextureLow) {\r\n                target._lodTextureLow.dispose();\r\n            }\r\n            target._lodTextureLow = this._lodTextureLow;\r\n        }\r\n\r\n        if (this._irradianceTexture) {\r\n            if (target._irradianceTexture) {\r\n                target._irradianceTexture.dispose();\r\n            }\r\n            target._irradianceTexture = this._irradianceTexture;\r\n        }\r\n\r\n        const cache = this._engine.getLoadedTexturesCache();\r\n        let index = cache.indexOf(this);\r\n        if (index !== -1) {\r\n            cache.splice(index, 1);\r\n        }\r\n\r\n        index = cache.indexOf(target);\r\n        if (index === -1) {\r\n            cache.push(target);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Dispose the current allocated resources\r\n     */\r\n    public dispose(): void {\r\n        this._references--;\r\n        if (this._references === 0) {\r\n            this.onLoadedObservable.clear();\r\n            this.onErrorObservable.clear();\r\n            this._engine._releaseTexture(this);\r\n            this._hardwareTexture = null;\r\n            this._dynamicTextureSource = null;\r\n        }\r\n    }\r\n}\r\n", "import type { Nullable } from \"../types\";\r\n\r\n/**\r\n * @internal\r\n **/\r\nexport class DepthCullingState {\r\n    protected _isDepthTestDirty = false;\r\n    protected _isDepthMaskDirty = false;\r\n    protected _isDepthFuncDirty = false;\r\n    protected _isCullFaceDirty = false;\r\n    protected _isCullDirty = false;\r\n    protected _isZOffsetDirty = false;\r\n    protected _isFrontFaceDirty = false;\r\n\r\n    protected _depthTest: boolean;\r\n    protected _depthMask: boolean;\r\n    protected _depthFunc: Nullable<number>;\r\n    protected _cull: Nullable<boolean>;\r\n    protected _cullFace: Nullable<number>;\r\n    protected _zOffset: number;\r\n    protected _zOffsetUnits: number;\r\n    protected _frontFace: Nullable<number>;\r\n\r\n    /**\r\n     * Initializes the state.\r\n     * @param reset\r\n     */\r\n    public constructor(reset = true) {\r\n        if (reset) {\r\n            this.reset();\r\n        }\r\n    }\r\n\r\n    public get isDirty(): boolean {\r\n        return (\r\n            this._isDepthFuncDirty ||\r\n            this._isDepthTestDirty ||\r\n            this._isDepthMaskDirty ||\r\n            this._isCullFaceDirty ||\r\n            this._isCullDirty ||\r\n            this._isZOffsetDirty ||\r\n            this._isFrontFaceDirty\r\n        );\r\n    }\r\n\r\n    public get zOffset(): number {\r\n        return this._zOffset;\r\n    }\r\n\r\n    public set zOffset(value: number) {\r\n        if (this._zOffset === value) {\r\n            return;\r\n        }\r\n\r\n        this._zOffset = value;\r\n        this._isZOffsetDirty = true;\r\n    }\r\n\r\n    public get zOffsetUnits(): number {\r\n        return this._zOffsetUnits;\r\n    }\r\n\r\n    public set zOffsetUnits(value: number) {\r\n        if (this._zOffsetUnits === value) {\r\n            return;\r\n        }\r\n\r\n        this._zOffsetUnits = value;\r\n        this._isZOffsetDirty = true;\r\n    }\r\n\r\n    public get cullFace(): Nullable<number> {\r\n        return this._cullFace;\r\n    }\r\n\r\n    public set cullFace(value: Nullable<number>) {\r\n        if (this._cullFace === value) {\r\n            return;\r\n        }\r\n\r\n        this._cullFace = value;\r\n        this._isCullFaceDirty = true;\r\n    }\r\n\r\n    public get cull(): Nullable<boolean> {\r\n        return this._cull;\r\n    }\r\n\r\n    public set cull(value: Nullable<boolean>) {\r\n        if (this._cull === value) {\r\n            return;\r\n        }\r\n\r\n        this._cull = value;\r\n        this._isCullDirty = true;\r\n    }\r\n\r\n    public get depthFunc(): Nullable<number> {\r\n        return this._depthFunc;\r\n    }\r\n\r\n    public set depthFunc(value: Nullable<number>) {\r\n        if (this._depthFunc === value) {\r\n            return;\r\n        }\r\n\r\n        this._depthFunc = value;\r\n        this._isDepthFuncDirty = true;\r\n    }\r\n\r\n    public get depthMask(): boolean {\r\n        return this._depthMask;\r\n    }\r\n\r\n    public set depthMask(value: boolean) {\r\n        if (this._depthMask === value) {\r\n            return;\r\n        }\r\n\r\n        this._depthMask = value;\r\n        this._isDepthMaskDirty = true;\r\n    }\r\n\r\n    public get depthTest(): boolean {\r\n        return this._depthTest;\r\n    }\r\n\r\n    public set depthTest(value: boolean) {\r\n        if (this._depthTest === value) {\r\n            return;\r\n        }\r\n\r\n        this._depthTest = value;\r\n        this._isDepthTestDirty = true;\r\n    }\r\n\r\n    public get frontFace(): Nullable<number> {\r\n        return this._frontFace;\r\n    }\r\n\r\n    public set frontFace(value: Nullable<number>) {\r\n        if (this._frontFace === value) {\r\n            return;\r\n        }\r\n\r\n        this._frontFace = value;\r\n        this._isFrontFaceDirty = true;\r\n    }\r\n\r\n    public reset() {\r\n        this._depthMask = true;\r\n        this._depthTest = true;\r\n        this._depthFunc = null;\r\n        this._cullFace = null;\r\n        this._cull = null;\r\n        this._zOffset = 0;\r\n        this._zOffsetUnits = 0;\r\n        this._frontFace = null;\r\n\r\n        this._isDepthTestDirty = true;\r\n        this._isDepthMaskDirty = true;\r\n        this._isDepthFuncDirty = false;\r\n        this._isCullFaceDirty = false;\r\n        this._isCullDirty = false;\r\n        this._isZOffsetDirty = true;\r\n        this._isFrontFaceDirty = false;\r\n    }\r\n\r\n    public apply(gl: WebGLRenderingContext) {\r\n        if (!this.isDirty) {\r\n            return;\r\n        }\r\n\r\n        // Cull\r\n        if (this._isCullDirty) {\r\n            if (this.cull) {\r\n                gl.enable(gl.CULL_FACE);\r\n            } else {\r\n                gl.disable(gl.CULL_FACE);\r\n            }\r\n\r\n            this._isCullDirty = false;\r\n        }\r\n\r\n        // Cull face\r\n        if (this._isCullFaceDirty) {\r\n            gl.cullFace(<number>this.cullFace);\r\n            this._isCullFaceDirty = false;\r\n        }\r\n\r\n        // Depth mask\r\n        if (this._isDepthMaskDirty) {\r\n            gl.depthMask(this.depthMask);\r\n            this._isDepthMaskDirty = false;\r\n        }\r\n\r\n        // Depth test\r\n        if (this._isDepthTestDirty) {\r\n            if (this.depthTest) {\r\n                gl.enable(gl.DEPTH_TEST);\r\n            } else {\r\n                gl.disable(gl.DEPTH_TEST);\r\n            }\r\n            this._isDepthTestDirty = false;\r\n        }\r\n\r\n        // Depth func\r\n        if (this._isDepthFuncDirty) {\r\n            gl.depthFunc(<number>this.depthFunc);\r\n            this._isDepthFuncDirty = false;\r\n        }\r\n\r\n        // zOffset\r\n        if (this._isZOffsetDirty) {\r\n            if (this.zOffset || this.zOffsetUnits) {\r\n                gl.enable(gl.POLYGON_OFFSET_FILL);\r\n                gl.polygonOffset(this.zOffset, this.zOffsetUnits);\r\n            } else {\r\n                gl.disable(gl.POLYGON_OFFSET_FILL);\r\n            }\r\n\r\n            this._isZOffsetDirty = false;\r\n        }\r\n\r\n        // Front face\r\n        if (this._isFrontFaceDirty) {\r\n            gl.frontFace(<number>this.frontFace);\r\n            this._isFrontFaceDirty = false;\r\n        }\r\n    }\r\n}\r\n", "import type { IStencilState } from \"./IStencilState\";\r\n\r\n/**\r\n * @internal\r\n **/\r\nexport class StencilStateComposer {\r\n    protected _isStencilTestDirty = false;\r\n    protected _isStencilMaskDirty = false;\r\n    protected _isStencilFuncDirty = false;\r\n    protected _isStencilOpDirty = false;\r\n\r\n    protected _enabled: boolean;\r\n\r\n    protected _mask: number;\r\n\r\n    protected _func: number;\r\n    protected _funcRef: number;\r\n    protected _funcMask: number;\r\n\r\n    protected _opStencilFail: number;\r\n    protected _opDepthFail: number;\r\n    protected _opStencilDepthPass: number;\r\n\r\n    protected _backFunc: number;\r\n    protected _backOpStencilFail: number;\r\n    protected _backOpDepthFail: number;\r\n    protected _backOpStencilDepthPass: number;\r\n\r\n    public stencilGlobal: IStencilState;\r\n    public stencilMaterial: IStencilState | undefined;\r\n\r\n    public useStencilGlobalOnly = false;\r\n\r\n    public get isDirty(): boolean {\r\n        return this._isStencilTestDirty || this._isStencilMaskDirty || this._isStencilFuncDirty || this._isStencilOpDirty;\r\n    }\r\n\r\n    public get func(): number {\r\n        return this._func;\r\n    }\r\n\r\n    public set func(value: number) {\r\n        if (this._func === value) {\r\n            return;\r\n        }\r\n\r\n        this._func = value;\r\n        this._isStencilFuncDirty = true;\r\n    }\r\n\r\n    public get backFunc(): number {\r\n        return this._func;\r\n    }\r\n\r\n    public set backFunc(value: number) {\r\n        if (this._backFunc === value) {\r\n            return;\r\n        }\r\n\r\n        this._backFunc = value;\r\n        this._isStencilFuncDirty = true;\r\n    }\r\n\r\n    public get funcRef(): number {\r\n        return this._funcRef;\r\n    }\r\n\r\n    public set funcRef(value: number) {\r\n        if (this._funcRef === value) {\r\n            return;\r\n        }\r\n\r\n        this._funcRef = value;\r\n        this._isStencilFuncDirty = true;\r\n    }\r\n\r\n    public get funcMask(): number {\r\n        return this._funcMask;\r\n    }\r\n\r\n    public set funcMask(value: number) {\r\n        if (this._funcMask === value) {\r\n            return;\r\n        }\r\n\r\n        this._funcMask = value;\r\n        this._isStencilFuncDirty = true;\r\n    }\r\n\r\n    public get opStencilFail(): number {\r\n        return this._opStencilFail;\r\n    }\r\n\r\n    public set opStencilFail(value: number) {\r\n        if (this._opStencilFail === value) {\r\n            return;\r\n        }\r\n\r\n        this._opStencilFail = value;\r\n        this._isStencilOpDirty = true;\r\n    }\r\n\r\n    public get opDepthFail(): number {\r\n        return this._opDepthFail;\r\n    }\r\n\r\n    public set opDepthFail(value: number) {\r\n        if (this._opDepthFail === value) {\r\n            return;\r\n        }\r\n\r\n        this._opDepthFail = value;\r\n        this._isStencilOpDirty = true;\r\n    }\r\n\r\n    public get opStencilDepthPass(): number {\r\n        return this._opStencilDepthPass;\r\n    }\r\n\r\n    public set opStencilDepthPass(value: number) {\r\n        if (this._opStencilDepthPass === value) {\r\n            return;\r\n        }\r\n\r\n        this._opStencilDepthPass = value;\r\n        this._isStencilOpDirty = true;\r\n    }\r\n\r\n    public get backOpStencilFail(): number {\r\n        return this._backOpStencilFail;\r\n    }\r\n\r\n    public set backOpStencilFail(value: number) {\r\n        if (this._backOpStencilFail === value) {\r\n            return;\r\n        }\r\n\r\n        this._backOpStencilFail = value;\r\n        this._isStencilOpDirty = true;\r\n    }\r\n\r\n    public get backOpDepthFail(): number {\r\n        return this._backOpDepthFail;\r\n    }\r\n\r\n    public set backOpDepthFail(value: number) {\r\n        if (this._backOpDepthFail === value) {\r\n            return;\r\n        }\r\n\r\n        this._backOpDepthFail = value;\r\n        this._isStencilOpDirty = true;\r\n    }\r\n\r\n    public get backOpStencilDepthPass(): number {\r\n        return this._backOpStencilDepthPass;\r\n    }\r\n\r\n    public set backOpStencilDepthPass(value: number) {\r\n        if (this._backOpStencilDepthPass === value) {\r\n            return;\r\n        }\r\n\r\n        this._backOpStencilDepthPass = value;\r\n        this._isStencilOpDirty = true;\r\n    }\r\n\r\n    public get mask(): number {\r\n        return this._mask;\r\n    }\r\n\r\n    public set mask(value: number) {\r\n        if (this._mask === value) {\r\n            return;\r\n        }\r\n\r\n        this._mask = value;\r\n        this._isStencilMaskDirty = true;\r\n    }\r\n\r\n    public get enabled(): boolean {\r\n        return this._enabled;\r\n    }\r\n\r\n    public set enabled(value: boolean) {\r\n        if (this._enabled === value) {\r\n            return;\r\n        }\r\n\r\n        this._enabled = value;\r\n        this._isStencilTestDirty = true;\r\n    }\r\n\r\n    public constructor(reset = true) {\r\n        if (reset) {\r\n            this.reset();\r\n        }\r\n    }\r\n\r\n    public reset() {\r\n        this.stencilMaterial = undefined;\r\n\r\n        this.stencilGlobal?.reset();\r\n\r\n        this._isStencilTestDirty = true;\r\n        this._isStencilMaskDirty = true;\r\n        this._isStencilFuncDirty = true;\r\n        this._isStencilOpDirty = true;\r\n    }\r\n\r\n    public apply(gl?: WebGLRenderingContext) {\r\n        if (!gl) {\r\n            return;\r\n        }\r\n\r\n        const stencilMaterialEnabled = !this.useStencilGlobalOnly && !!this.stencilMaterial?.enabled;\r\n\r\n        this.enabled = stencilMaterialEnabled ? this.stencilMaterial!.enabled : this.stencilGlobal.enabled;\r\n        this.func = stencilMaterialEnabled ? this.stencilMaterial!.func : this.stencilGlobal.func;\r\n        this.backFunc = stencilMaterialEnabled ? this.stencilMaterial!.backFunc : this.stencilGlobal.backFunc;\r\n        this.funcRef = stencilMaterialEnabled ? this.stencilMaterial!.funcRef : this.stencilGlobal.funcRef;\r\n        this.funcMask = stencilMaterialEnabled ? this.stencilMaterial!.funcMask : this.stencilGlobal.funcMask;\r\n        this.opStencilFail = stencilMaterialEnabled ? this.stencilMaterial!.opStencilFail : this.stencilGlobal.opStencilFail;\r\n        this.opDepthFail = stencilMaterialEnabled ? this.stencilMaterial!.opDepthFail : this.stencilGlobal.opDepthFail;\r\n        this.opStencilDepthPass = stencilMaterialEnabled ? this.stencilMaterial!.opStencilDepthPass : this.stencilGlobal.opStencilDepthPass;\r\n        this.backOpStencilFail = stencilMaterialEnabled ? this.stencilMaterial!.backOpStencilFail : this.stencilGlobal.backOpStencilFail;\r\n        this.backOpDepthFail = stencilMaterialEnabled ? this.stencilMaterial!.backOpDepthFail : this.stencilGlobal.backOpDepthFail;\r\n        this.backOpStencilDepthPass = stencilMaterialEnabled ? this.stencilMaterial!.backOpStencilDepthPass : this.stencilGlobal.backOpStencilDepthPass;\r\n        this.mask = stencilMaterialEnabled ? this.stencilMaterial!.mask : this.stencilGlobal.mask;\r\n\r\n        if (!this.isDirty) {\r\n            return;\r\n        }\r\n\r\n        // Stencil test\r\n        if (this._isStencilTestDirty) {\r\n            if (this.enabled) {\r\n                gl.enable(gl.STENCIL_TEST);\r\n            } else {\r\n                gl.disable(gl.STENCIL_TEST);\r\n            }\r\n            this._isStencilTestDirty = false;\r\n        }\r\n\r\n        // Stencil mask\r\n        if (this._isStencilMaskDirty) {\r\n            gl.stencilMask(this.mask);\r\n            this._isStencilMaskDirty = false;\r\n        }\r\n\r\n        // Stencil func\r\n        if (this._isStencilFuncDirty) {\r\n            gl.stencilFuncSeparate(gl.FRONT, this.func, this.funcRef, this.funcMask);\r\n            gl.stencilFuncSeparate(gl.BACK, this.backFunc, this.funcRef, this.funcMask);\r\n            this._isStencilFuncDirty = false;\r\n        }\r\n\r\n        // Stencil op\r\n        if (this._isStencilOpDirty) {\r\n            gl.stencilOpSeparate(gl.FRONT, this.opStencilFail, this.opDepthFail, this.opStencilDepthPass);\r\n            gl.stencilOpSeparate(gl.BACK, this.backOpStencilFail, this.backOpDepthFail, this.backOpStencilDepthPass);\r\n            this._isStencilOpDirty = false;\r\n        }\r\n    }\r\n}\r\n", "import { Constants } from \"../Engines/constants\";\r\nimport type { IStencilState } from \"./IStencilState\";\r\n\r\n/**\r\n * @internal\r\n **/\r\nexport class StencilState implements IStencilState {\r\n    /** Passed to depthFunction or stencilFunction to specify depth or stencil tests will always pass. i.e. Pixels will be drawn in the order they are drawn */\r\n    public static readonly ALWAYS = Constants.ALWAYS;\r\n    /** Passed to stencilOperation to specify that stencil value must be kept */\r\n    public static readonly KEEP = Constants.KEEP;\r\n    /** Passed to stencilOperation to specify that stencil value must be replaced */\r\n    public static readonly REPLACE = Constants.REPLACE;\r\n\r\n    public constructor() {\r\n        this.reset();\r\n    }\r\n\r\n    public reset() {\r\n        this.enabled = false;\r\n        this.mask = 0xff;\r\n\r\n        this.funcRef = 1;\r\n        this.funcMask = 0xff;\r\n\r\n        this.func = StencilState.ALWAYS;\r\n        this.opStencilFail = StencilState.KEEP;\r\n        this.opDepthFail = StencilState.KEEP;\r\n        this.opStencilDepthPass = StencilState.REPLACE;\r\n\r\n        this.backFunc = StencilState.ALWAYS;\r\n        this.backOpStencilFail = StencilState.KEEP;\r\n        this.backOpDepthFail = StencilState.KEEP;\r\n        this.backOpStencilDepthPass = StencilState.REPLACE;\r\n    }\r\n\r\n    public func: number;\r\n    public get stencilFunc(): number {\r\n        return this.func;\r\n    }\r\n\r\n    public set stencilFunc(value: number) {\r\n        this.func = value;\r\n    }\r\n\r\n    public backFunc: number;\r\n    public get stencilBackFunc(): number {\r\n        return this.backFunc;\r\n    }\r\n\r\n    public set stencilBackFunc(value: number) {\r\n        this.backFunc = value;\r\n    }\r\n\r\n    public funcRef: number;\r\n    public get stencilFuncRef(): number {\r\n        return this.funcRef;\r\n    }\r\n\r\n    public set stencilFuncRef(value: number) {\r\n        this.funcRef = value;\r\n    }\r\n\r\n    public funcMask: number;\r\n    public get stencilFuncMask(): number {\r\n        return this.funcMask;\r\n    }\r\n\r\n    public set stencilFuncMask(value: number) {\r\n        this.funcMask = value;\r\n    }\r\n\r\n    public opStencilFail: number;\r\n    public get stencilOpStencilFail(): number {\r\n        return this.opStencilFail;\r\n    }\r\n\r\n    public set stencilOpStencilFail(value: number) {\r\n        this.opStencilFail = value;\r\n    }\r\n\r\n    public opDepthFail: number;\r\n    public get stencilOpDepthFail(): number {\r\n        return this.opDepthFail;\r\n    }\r\n\r\n    public set stencilOpDepthFail(value: number) {\r\n        this.opDepthFail = value;\r\n    }\r\n\r\n    public opStencilDepthPass: number;\r\n    public get stencilOpStencilDepthPass(): number {\r\n        return this.opStencilDepthPass;\r\n    }\r\n\r\n    public set stencilOpStencilDepthPass(value: number) {\r\n        this.opStencilDepthPass = value;\r\n    }\r\n\r\n    public backOpStencilFail: number;\r\n    public get stencilBackOpStencilFail(): number {\r\n        return this.backOpStencilFail;\r\n    }\r\n\r\n    public set stencilBackOpStencilFail(value: number) {\r\n        this.backOpStencilFail = value;\r\n    }\r\n\r\n    public backOpDepthFail: number;\r\n    public get stencilBackOpDepthFail(): number {\r\n        return this.backOpDepthFail;\r\n    }\r\n\r\n    public set stencilBackOpDepthFail(value: number) {\r\n        this.backOpDepthFail = value;\r\n    }\r\n\r\n    public backOpStencilDepthPass: number;\r\n    public get stencilBackOpStencilDepthPass(): number {\r\n        return this.backOpStencilDepthPass;\r\n    }\r\n\r\n    public set stencilBackOpStencilDepthPass(value: number) {\r\n        this.backOpStencilDepthPass = value;\r\n    }\r\n\r\n    public mask: number;\r\n    public get stencilMask(): number {\r\n        return this.mask;\r\n    }\r\n\r\n    public set stencilMask(value: number) {\r\n        this.mask = value;\r\n    }\r\n\r\n    public enabled: boolean;\r\n    public get stencilTest(): boolean {\r\n        return this.enabled;\r\n    }\r\n\r\n    public set stencilTest(value: boolean) {\r\n        this.enabled = value;\r\n    }\r\n}\r\n", "import type { Observer } from \"../Misc/observable\";\r\nimport type { DataArray, FloatArray, IndicesArray, Nullable } from \"../types\";\r\nimport type { PerfCounter } from \"../Misc/perfCounter\";\r\nimport type { PostProcess } from \"../PostProcesses/postProcess\";\r\nimport type { Scene } from \"../scene\";\r\nimport type { IColor4Like, IViewportLike } from \"../Maths/math.like\";\r\nimport type { ICanvas, IImage, IPath2D } from \"./ICanvas\";\r\nimport type { IHardwareTextureWrapper } from \"../Materials/Textures/hardwareTextureWrapper\";\r\nimport type { EngineCapabilities } from \"./engineCapabilities\";\r\nimport type { DataBuffer } from \"../Buffers/dataBuffer\";\r\nimport type { RenderTargetWrapper } from \"./renderTargetWrapper\";\r\nimport type { IShaderProcessor } from \"./Processors/iShaderProcessor\";\r\nimport type { ShaderLanguage } from \"../Materials/shaderLanguage\";\r\nimport type { IAudioEngineOptions } from \"../Audio/Interfaces/IAudioEngineOptions\";\r\nimport type { EngineFeatures } from \"./engineFeatures\";\r\nimport type { UniformBuffer } from \"../Materials/uniformBuffer\";\r\nimport type { StorageBuffer } from \"../Buffers/storageBuffer\";\r\nimport type { IEffectCreationOptions, IShaderPath } from \"../Materials/effect\";\r\nimport type { IOfflineProvider } from \"../Offline/IOfflineProvider\";\r\nimport type { IWebRequest } from \"../Misc/interfaces/iWebRequest\";\r\nimport type { IFileRequest } from \"../Misc/fileRequest\";\r\nimport type { Texture } from \"../Materials/Textures/texture\";\r\nimport type { LoadFileError } from \"../Misc/fileTools\";\r\nimport type { _IShaderProcessingContext } from \"./Processors/shaderProcessingOptions\";\r\nimport type { IPipelineContext } from \"./IPipelineContext\";\r\nimport type { ThinTexture } from \"../Materials/Textures/thinTexture\";\r\nimport type { InternalTextureCreationOptions, TextureSize } from \"../Materials/Textures/textureCreationOptions\";\r\nimport type { EffectFallbacks } from \"../Materials/effectFallbacks\";\r\nimport type { IMaterialContext } from \"./IMaterialContext\";\r\nimport type { IStencilStateProperties, IStencilState } from \"../States/IStencilState\";\r\nimport type { DrawWrapper } from \"../Materials/drawWrapper\";\r\nimport type { IDrawContext } from \"./IDrawContext\";\r\nimport type { VertexBuffer } from \"../Meshes/buffer\";\r\nimport type { IAudioEngine } from \"../Audio/Interfaces/IAudioEngine\";\r\nimport type { WebRequest } from \"core/Misc/webRequest\";\r\nimport type { PerformanceMonitor } from \"core/Misc/performanceMonitor\";\r\nimport type { ILoadingScreen } from \"../Loading/loadingScreen\";\r\nimport { EngineStore } from \"./engineStore\";\r\nimport { Logger } from \"../Misc/logger\";\r\nimport { Effect } from \"../Materials/effect\";\r\nimport { PerformanceConfigurator } from \"./performanceConfigurator\";\r\nimport { PrecisionDate } from \"../Misc/precisionDate\";\r\nimport { DepthCullingState } from \"../States/depthCullingState\";\r\nimport { StencilStateComposer } from \"../States/stencilStateComposer\";\r\nimport { StencilState } from \"../States/stencilState\";\r\nimport { AlphaState } from \"../States/alphaCullingState\";\r\nimport { _WarnImport } from \"../Misc/devTools\";\r\nimport { InternalTexture, InternalTextureSource } from \"../Materials/Textures/internalTexture\";\r\nimport { IsDocumentAvailable, IsNavigatorAvailable, IsWindowObjectExist } from \"../Misc/domManagement\";\r\nimport { Constants } from \"./constants\";\r\nimport { Observable } from \"../Misc/observable\";\r\nimport { EngineFunctionContext, _LoadFile } from \"./abstractEngine.functions\";\r\nimport type { Material } from \"core/Materials/material\";\r\nimport type { IInternalTextureLoader } from \"../Materials/Textures/Loaders/internalTextureLoader\";\r\n\r\n/**\r\n * Defines the interface used by objects working like Scene\r\n * @internal\r\n */\r\nexport interface ISceneLike {\r\n    /** Add pending data  (to load) */\r\n    addPendingData(data: any): void;\r\n    /** Remove pending data */\r\n    removePendingData(data: any): void;\r\n    /** Offline provider */\r\n    offlineProvider: IOfflineProvider;\r\n}\r\n\r\n/**\r\n * Queue a new function into the requested animation frame pool (ie. this function will be executed by the browser (or the javascript engine) for the next frame)\r\n * @param func - the function to be called\r\n * @param requester - the object that will request the next frame. Falls back to window.\r\n * @returns frame number\r\n */\r\nexport function QueueNewFrame(func: () => void, requester?: any): number {\r\n    // Note that there is kind of a typing issue here, as `setTimeout` might return something else than a number (NodeJs returns a NodeJS.Timeout object).\r\n    // Also if the global `requestAnimationFrame`'s returnType is number, `requester.requestPostAnimationFrame` and `requester.requestAnimationFrame` types\r\n    // are `any`.\r\n\r\n    if (!IsWindowObjectExist()) {\r\n        if (typeof requestAnimationFrame === \"function\") {\r\n            return requestAnimationFrame(func);\r\n        }\r\n    } else {\r\n        const { requestAnimationFrame } = (requester || window) as { requestAnimationFrame: (callback: FrameRequestCallback) => number };\r\n        if (typeof requestAnimationFrame === \"function\") {\r\n            return requestAnimationFrame(func);\r\n        }\r\n    }\r\n\r\n    // fallback to the global `setTimeout`.\r\n    // In most cases (aka in the browser), `window` is the global object, so instead of calling `window.setTimeout` we could call the global `setTimeout`.\r\n    return setTimeout(func, 16) as unknown as number;\r\n}\r\n\r\n/** Interface defining initialization parameters for AbstractEngine class */\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface AbstractEngineOptions {\r\n    /**\r\n     * Defines if the engine should no exceed a specified device ratio\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio\r\n     */\r\n    limitDeviceRatio?: number;\r\n    /**\r\n     * Defines if webaudio should be initialized as well\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/audio/playingSoundsMusic\r\n     */\r\n    audioEngine?: boolean;\r\n    /**\r\n     * Specifies options for the audio engine\r\n     */\r\n    audioEngineOptions?: IAudioEngineOptions;\r\n\r\n    /**\r\n     * Defines if animations should run using a deterministic lock step\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/animation/advanced_animations#deterministic-lockstep\r\n     */\r\n    deterministicLockstep?: boolean;\r\n    /** Defines the maximum steps to use with deterministic lock step mode */\r\n    lockstepMaxSteps?: number;\r\n    /** Defines the seconds between each deterministic lock step */\r\n    timeStep?: number;\r\n    /**\r\n     * Defines that engine should ignore context lost events\r\n     * If this event happens when this parameter is true, you will have to reload the page to restore rendering\r\n     */\r\n    doNotHandleContextLost?: boolean;\r\n    /**\r\n     * Defines that engine should ignore modifying touch action attribute and style\r\n     * If not handle, you might need to set it up on your side for expected touch devices behavior.\r\n     */\r\n    doNotHandleTouchAction?: boolean;\r\n\r\n    /**\r\n     * Make the matrix computations to be performed in 64 bits instead of 32 bits. False by default.\r\n     * Note that setting useLargeWorldRendering will also set high precision matrices\r\n     */\r\n    useHighPrecisionMatrix?: boolean;\r\n\r\n    /**\r\n     * @experimental\r\n     * LargeWorldRendering helps avoid floating point imprecision of rendering large worlds by\r\n     * 1. Forcing highPrecisionMatrices (matrix computations in 64 bits instead of 32)\r\n     * 2. Enabling floatingOriginMode in all scenes -- offsetting position-related uniform and attribute values before passing to shader so that active camera is centered at origin and world is offset by active camera position\r\n     *\r\n     * NOTE that if this mode is set during engineCreation, all scenes will have floatingOrigin offset and you do not need to send floatingOriginMode option to each scene creation.\r\n     * If you'd like to have only specific scenes using the offset logic, you can set the flag on those scenes directly -- however, to achieve proper large world rendering, you must also set the useHighPrecisionMatrix option on engine.\r\n     */\r\n    readonly useLargeWorldRendering?: boolean;\r\n\r\n    /**\r\n     * Defines whether to adapt to the device's viewport characteristics (default: false)\r\n     */\r\n    adaptToDeviceRatio?: boolean;\r\n\r\n    /**\r\n     * Defines whether MSAA is enabled on the canvas.\r\n     */\r\n    antialias?: boolean;\r\n\r\n    /**\r\n     * Defines whether the stencil buffer should be enabled.\r\n     */\r\n    stencil?: boolean;\r\n\r\n    /**\r\n     * Defines whether the canvas should be created in \"premultiplied\" mode (if false, the canvas is created in the \"opaque\" mode) (true by default)\r\n     */\r\n    premultipliedAlpha?: boolean;\r\n    /**\r\n     * True if the more expensive but exact conversions should be used for transforming colors to and from linear space within shaders.\r\n     * Otherwise, the default is to use a cheaper approximation.\r\n     */\r\n    useExactSrgbConversions?: boolean;\r\n}\r\n\r\n/**\r\n * Information about the current host\r\n */\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface HostInformation {\r\n    /**\r\n     * Defines if the current host is a mobile\r\n     */\r\n    isMobile: boolean;\r\n}\r\n\r\nexport type PrepareTextureProcessFunction = (\r\n    width: number,\r\n    height: number,\r\n    img: HTMLImageElement | ImageBitmap | { width: number; height: number },\r\n    extension: string,\r\n    texture: InternalTexture,\r\n    continuationCallback: () => void\r\n) => boolean;\r\n\r\nexport type PrepareTextureFunction = (\r\n    texture: InternalTexture,\r\n    extension: string,\r\n    scene: Nullable<ISceneLike>,\r\n    img: HTMLImageElement | ImageBitmap | { width: number; height: number },\r\n    invertY: boolean,\r\n    noMipmap: boolean,\r\n    isCompressed: boolean,\r\n    processFunction: PrepareTextureProcessFunction,\r\n    samplingMode: number\r\n) => void;\r\n\r\n/**\r\n * The parent class for specialized engines (WebGL, WebGPU)\r\n */\r\nexport abstract class AbstractEngine {\r\n    // States\r\n    /** @internal */\r\n    protected _colorWrite = true;\r\n    /** @internal */\r\n    protected _colorWriteChanged = true;\r\n    /** @internal */\r\n    public _depthCullingState = new DepthCullingState();\r\n    /** @internal */\r\n    protected _stencilStateComposer = new StencilStateComposer();\r\n    /** @internal */\r\n    public _stencilState = new StencilState();\r\n    /** @internal */\r\n    public _alphaState = new AlphaState(false);\r\n    /** @internal */\r\n    public _alphaMode = Array(8).fill(-1);\r\n    /** @internal */\r\n    public _alphaEquation = Array(8).fill(-1);\r\n\r\n    protected _activeRequests: IFileRequest[] = [];\r\n\r\n    /** @internal */\r\n    public _badOS = false;\r\n    /** @internal */\r\n    public _badDesktopOS = false;\r\n    /** @internal */\r\n    public _videoTextureSupported: boolean;\r\n\r\n    protected _compatibilityMode = true;\r\n    /** @internal */\r\n    public _pointerLockRequested: boolean;\r\n    /** @internal */\r\n    public _loadingScreen: ILoadingScreen;\r\n    /** @internal */\r\n    public _renderingCanvas: Nullable<HTMLCanvasElement>;\r\n    /** @internal */\r\n    public _internalTexturesCache = new Array<InternalTexture>();\r\n    protected _currentEffect: Nullable<Effect>;\r\n    /** @internal */\r\n    protected _cachedVertexBuffers: any;\r\n    /** @internal */\r\n    protected _cachedIndexBuffer: Nullable<DataBuffer>;\r\n    /** @internal */\r\n    protected _cachedEffectForVertexBuffers: Nullable<Effect>;\r\n    /** @internal */\r\n    public _currentRenderTarget: Nullable<RenderTargetWrapper> = null;\r\n    /** @internal */\r\n    public _caps: EngineCapabilities;\r\n    /** @internal */\r\n    protected _cachedViewport: Nullable<IViewportLike>;\r\n    /** @internal */\r\n    public _currentDrawContext: IDrawContext;\r\n    /** @internal */\r\n    public _currentMaterialContext: IMaterialContext;\r\n\r\n    /** @internal */\r\n    protected _boundTexturesCache: { [key: string]: Nullable<InternalTexture> } = {};\r\n    /** @internal */\r\n    protected _activeChannel = 0;\r\n    /** @internal */\r\n    protected _currentTextureChannel = -1;\r\n    /** @internal */\r\n    protected _viewportCached = { x: 0, y: 0, z: 0, w: 0 };\r\n\r\n    /** @internal */\r\n    protected _isWebGPU: boolean = false;\r\n\r\n    /** @internal */\r\n    public _enableGPUDebugMarkers: boolean = false;\r\n\r\n    // Focus\r\n    /** @internal */\r\n    public _onFocus: () => void;\r\n    /** @internal */\r\n    public _onBlur: () => void;\r\n    /** @internal */\r\n    public _onCanvasPointerOut: (event: PointerEvent) => void;\r\n    /** @internal */\r\n    public _onCanvasBlur: () => void;\r\n    /** @internal */\r\n    public _onCanvasFocus: () => void;\r\n    /** @internal */\r\n    public _onCanvasContextMenu: (evt: Event) => void;\r\n    /** @internal */\r\n    public _onFullscreenChange: () => void;\r\n\r\n    /**\r\n     * Observable event triggered each time the canvas loses focus\r\n     */\r\n    public onCanvasBlurObservable = new Observable<AbstractEngine>();\r\n    /**\r\n     * Observable event triggered each time the canvas gains focus\r\n     */\r\n    public onCanvasFocusObservable = new Observable<AbstractEngine>();\r\n\r\n    /**\r\n     * Event raised when a new scene is created\r\n     */\r\n    public onNewSceneAddedObservable = new Observable<Scene>();\r\n\r\n    /**\r\n     * Observable event triggered each time the rendering canvas is resized\r\n     */\r\n    public onResizeObservable = new Observable<AbstractEngine>();\r\n\r\n    /**\r\n     * Observable event triggered each time the canvas receives pointerout event\r\n     */\r\n    public onCanvasPointerOutObservable = new Observable<PointerEvent>();\r\n\r\n    /**\r\n     * Observable event triggered each time an effect compilation fails\r\n     */\r\n    public onEffectErrorObservable = new Observable<{ effect: Effect; errors: string }>();\r\n\r\n    /**\r\n     * Turn this value on if you want to pause FPS computation when in background\r\n     */\r\n    public disablePerformanceMonitorInBackground = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that vertex array object must be disabled even if they are supported\r\n     */\r\n    public disableVertexArrayObjects = false;\r\n\r\n    /** @internal */\r\n    protected _frameId = 0;\r\n    /**\r\n     * Gets the current frame id\r\n     */\r\n    public get frameId(): number {\r\n        return this._frameId;\r\n    }\r\n    /**\r\n     * Gets a boolean indicating if the engine runs in WebGPU or not.\r\n     */\r\n    public get isWebGPU(): boolean {\r\n        return this._isWebGPU;\r\n    }\r\n\r\n    protected _shaderProcessor: Nullable<IShaderProcessor>;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getShaderProcessor(_shaderLanguage: ShaderLanguage): Nullable<IShaderProcessor> {\r\n        return this._shaderProcessor;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _resetAlphaMode(): void {\r\n        this._alphaMode.fill(-1);\r\n        this._alphaEquation.fill(-1);\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if all created effects are ready\r\n     * @returns true if all effects are ready\r\n     */\r\n    public abstract areAllEffectsReady(): boolean;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public abstract _executeWhenRenderingStateIsCompiled(pipelineContext: IPipelineContext, action: () => void): void;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public abstract _setTexture(channel: number, texture: Nullable<ThinTexture>, isPartOfTextureArray?: boolean, depthStencilTexture?: boolean, name?: string): boolean;\r\n\r\n    /**\r\n     * Sets a texture to the according uniform.\r\n     * @param channel The texture channel\r\n     * @param unused unused parameter\r\n     * @param texture The texture to apply\r\n     * @param name The name of the uniform in the effect\r\n     */\r\n    public abstract setTexture(channel: number, unused: Nullable<WebGLUniformLocation>, texture: Nullable<ThinTexture>, name: string): void;\r\n\r\n    /**\r\n     * Binds an effect to the webGL context\r\n     * @param effect defines the effect to bind\r\n     */\r\n    public abstract bindSamplers(effect: Effect): void;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public abstract _bindTexture(channel: number, texture: Nullable<InternalTexture>, name: string): void;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public abstract _deletePipelineContext(pipelineContext: IPipelineContext): void;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public abstract _preparePipelineContextAsync(\r\n        pipelineContext: IPipelineContext,\r\n        vertexSourceCode: string,\r\n        fragmentSourceCode: string,\r\n        createAsRaw: boolean,\r\n        rawVertexSourceCode: string,\r\n        rawFragmentSourceCode: string,\r\n        rebuildRebind: any,\r\n        defines: Nullable<string>,\r\n        transformFeedbackVaryings: Nullable<string[]>,\r\n        key: string,\r\n        onReady: () => void\r\n    ): void;\r\n\r\n    /** @internal */\r\n    protected _shaderPlatformName: string;\r\n    /**\r\n     * Gets the shader platform name used by the effects.\r\n     */\r\n    public get shaderPlatformName(): string {\r\n        return this._shaderPlatformName;\r\n    }\r\n\r\n    /**\r\n     * Gets information about the current host\r\n     */\r\n    public hostInformation: HostInformation = {\r\n        isMobile: false,\r\n    };\r\n\r\n    /**\r\n     * Gets a boolean indicating if the engine is currently rendering in fullscreen mode\r\n     */\r\n    public isFullscreen = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean to enable/disable IndexedDB support and avoid XHR on .manifest\r\n     **/\r\n    public enableOfflineSupport = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean to enable/disable checking manifest if IndexedDB support is enabled (js will always consider the database is up to date)\r\n     **/\r\n    public disableManifestCheck = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean to enable/disable the context menu (right-click) from appearing on the main canvas\r\n     */\r\n    public disableContextMenu: boolean = true;\r\n\r\n    /**\r\n     * Gets or sets the current render pass id\r\n     */\r\n    public currentRenderPassId = Constants.RENDERPASS_MAIN;\r\n\r\n    /**\r\n     * Gets a boolean indicating if the pointer is currently locked\r\n     */\r\n    public isPointerLock = false;\r\n\r\n    /**\r\n     * Gets the list of created postprocesses\r\n     */\r\n    public postProcesses: PostProcess[] = [];\r\n\r\n    /** Gets or sets the tab index to set to the rendering canvas. 1 is the minimum value to set to be able to capture keyboard events */\r\n    public canvasTabIndex = 1;\r\n\r\n    /** @internal */\r\n    protected _onContextLost: (evt: Event) => void;\r\n    /** @internal */\r\n    protected _onContextRestored: (evt: Event) => void;\r\n    /** @internal */\r\n    protected _contextWasLost = false;\r\n\r\n    private _emptyTexture: Nullable<InternalTexture>;\r\n    private _emptyCubeTexture: Nullable<InternalTexture>;\r\n    private _emptyTexture3D: Nullable<InternalTexture>;\r\n    private _emptyTexture2DArray: Nullable<InternalTexture>;\r\n\r\n    protected _clearEmptyResources(): void {\r\n        this._emptyTexture = null;\r\n        this._emptyCubeTexture = null;\r\n        this._emptyTexture3D = null;\r\n        this._emptyTexture2DArray = null;\r\n    }\r\n\r\n    public abstract wipeCaches(bruteForce?: boolean): void;\r\n\r\n    private _useReverseDepthBuffer = false;\r\n    /**\r\n     * Gets or sets a boolean indicating if depth buffer should be reverse, going from far to near.\r\n     * This can provide greater z depth for distant objects.\r\n     */\r\n    public get useReverseDepthBuffer(): boolean {\r\n        return this._useReverseDepthBuffer;\r\n    }\r\n\r\n    public set useReverseDepthBuffer(useReverse) {\r\n        if (useReverse === this._useReverseDepthBuffer) {\r\n            return;\r\n        }\r\n\r\n        this._useReverseDepthBuffer = useReverse;\r\n\r\n        if (useReverse) {\r\n            this._depthCullingState.depthFunc = Constants.GEQUAL;\r\n        } else {\r\n            this._depthCullingState.depthFunc = Constants.LEQUAL;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Enable or disable color writing\r\n     * @param enable defines the state to set\r\n     */\r\n    public setColorWrite(enable: boolean): void {\r\n        if (enable !== this._colorWrite) {\r\n            this._colorWriteChanged = true;\r\n            this._colorWrite = enable;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if color writing is enabled\r\n     * @returns the current color writing state\r\n     */\r\n    public getColorWrite(): boolean {\r\n        return this._colorWrite;\r\n    }\r\n\r\n    /**\r\n     * Gets the depth culling state manager\r\n     */\r\n    public get depthCullingState(): DepthCullingState {\r\n        return this._depthCullingState;\r\n    }\r\n\r\n    /**\r\n     * Gets the alpha state manager\r\n     */\r\n    public get alphaState(): AlphaState {\r\n        return this._alphaState;\r\n    }\r\n\r\n    /**\r\n     * Gets the stencil state manager\r\n     */\r\n    public get stencilState(): StencilState {\r\n        return this._stencilState;\r\n    }\r\n\r\n    /**\r\n     * Gets the stencil state composer\r\n     */\r\n    public get stencilStateComposer(): StencilStateComposer {\r\n        return this._stencilStateComposer;\r\n    }\r\n\r\n    /**\r\n     * Indicates if the z range in NDC space is 0..1 (value: true) or -1..1 (value: false)\r\n     */\r\n    public readonly isNDCHalfZRange: boolean = false;\r\n\r\n    /**\r\n     * Indicates that the origin of the texture/framebuffer space is the bottom left corner. If false, the origin is top left\r\n     */\r\n    public readonly hasOriginBottomLeft: boolean = true;\r\n\r\n    /**\r\n     * Gets a boolean indicating if the exact sRGB conversions or faster approximations are used for converting to and from linear space.\r\n     */\r\n    public readonly useExactSrgbConversions: boolean;\r\n\r\n    /** @internal */\r\n    public _getGlobalDefines(defines?: { [key: string]: string }): string | undefined {\r\n        if (defines) {\r\n            if (this.isNDCHalfZRange) {\r\n                defines[\"IS_NDC_HALF_ZRANGE\"] = \"\";\r\n            } else {\r\n                delete defines[\"IS_NDC_HALF_ZRANGE\"];\r\n            }\r\n            if (this.useReverseDepthBuffer) {\r\n                defines[\"USE_REVERSE_DEPTHBUFFER\"] = \"\";\r\n            } else {\r\n                delete defines[\"USE_REVERSE_DEPTHBUFFER\"];\r\n            }\r\n            if (this.useExactSrgbConversions) {\r\n                defines[\"USE_EXACT_SRGB_CONVERSIONS\"] = \"\";\r\n            } else {\r\n                delete defines[\"USE_EXACT_SRGB_CONVERSIONS\"];\r\n            }\r\n            return;\r\n        } else {\r\n            let s = \"\";\r\n            if (this.isNDCHalfZRange) {\r\n                s += \"#define IS_NDC_HALF_ZRANGE\";\r\n            }\r\n            if (this.useReverseDepthBuffer) {\r\n                if (s) {\r\n                    s += \"\\n\";\r\n                }\r\n                s += \"#define USE_REVERSE_DEPTHBUFFER\";\r\n            }\r\n            if (this.useExactSrgbConversions) {\r\n                if (s) {\r\n                    s += \"\\n\";\r\n                }\r\n                s += \"#define USE_EXACT_SRGB_CONVERSIONS\";\r\n            }\r\n            return s;\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _renderTargetWrapperCache = new Array<RenderTargetWrapper>();\r\n    /** @internal */\r\n    protected _compiledEffects: { [key: string]: Effect } = {};\r\n\r\n    private _rebuildInternalTextures(): void {\r\n        const currentState = this._internalTexturesCache.slice(); // Do a copy because the rebuild will add proxies\r\n\r\n        for (const internalTexture of currentState) {\r\n            internalTexture._rebuild();\r\n        }\r\n    }\r\n\r\n    private _rebuildRenderTargetWrappers(): void {\r\n        const currentState = this._renderTargetWrapperCache.slice(); // Do a copy because the rebuild will add proxies\r\n\r\n        for (const renderTargetWrapper of currentState) {\r\n            renderTargetWrapper._rebuild();\r\n        }\r\n    }\r\n\r\n    private _rebuildEffects(): void {\r\n        for (const key in this._compiledEffects) {\r\n            const effect = this._compiledEffects[key];\r\n\r\n            effect._pipelineContext = null; // because _prepareEffect will try to dispose this pipeline before recreating it and that would lead to webgl errors\r\n            effect._prepareEffect();\r\n        }\r\n\r\n        Effect.ResetCache();\r\n    }\r\n\r\n    protected _rebuildGraphicsResources(): void {\r\n        // Ensure webgl and engine states are matching\r\n        this.wipeCaches(true);\r\n\r\n        // Rebuild effects\r\n        this._rebuildEffects();\r\n        this._rebuildComputeEffects?.();\r\n\r\n        // Note:\r\n        //  The call to _rebuildBuffers must be made before the call to _rebuildInternalTextures because in the process of _rebuildBuffers the buffers used by the post process managers will be rebuilt\r\n        //  and we may need to use the post process manager of the scene during _rebuildInternalTextures (in WebGL1, non-POT textures are rescaled using a post process + post process manager of the scene)\r\n\r\n        // Rebuild buffers\r\n        this._rebuildBuffers();\r\n        // Rebuild textures\r\n        this._rebuildInternalTextures();\r\n        // Rebuild textures\r\n        this._rebuildTextures();\r\n        // Rebuild textures\r\n        this._rebuildRenderTargetWrappers();\r\n\r\n        // Reset engine states after all the buffer/textures/... have been rebuilt\r\n        this.wipeCaches(true);\r\n    }\r\n\r\n    protected _flagContextRestored(): void {\r\n        Logger.Warn(this.name + \" context successfully restored.\");\r\n        this.onContextRestoredObservable.notifyObservers(this);\r\n        this._contextWasLost = false;\r\n    }\r\n\r\n    protected _restoreEngineAfterContextLost(initEngine: () => void): void {\r\n        // Adding a timeout to avoid race condition at browser level\r\n        setTimeout(() => {\r\n            this._clearEmptyResources();\r\n\r\n            const depthTest = this._depthCullingState.depthTest; // backup those values because the call to initEngine / wipeCaches will reset them\r\n            const depthFunc = this._depthCullingState.depthFunc;\r\n            const depthMask = this._depthCullingState.depthMask;\r\n            const stencilTest = this._stencilState.stencilTest;\r\n\r\n            // Rebuild context\r\n            initEngine();\r\n            this._rebuildGraphicsResources();\r\n\r\n            this._depthCullingState.depthTest = depthTest;\r\n            this._depthCullingState.depthFunc = depthFunc;\r\n            this._depthCullingState.depthMask = depthMask;\r\n            this._stencilState.stencilTest = stencilTest;\r\n\r\n            this._flagContextRestored();\r\n        }, 0);\r\n    }\r\n\r\n    /** @internal */\r\n    protected _isDisposed = false;\r\n\r\n    /** Gets a boolean indicating if the engine was disposed */\r\n    public get isDisposed(): boolean {\r\n        return this._isDisposed;\r\n    }\r\n\r\n    /**\r\n     * Gets the list of created scenes\r\n     */\r\n    public scenes: Scene[] = [];\r\n\r\n    /** @internal */\r\n    public _virtualScenes = new Array<Scene>();\r\n\r\n    /** @internal */\r\n    public _features: EngineFeatures;\r\n\r\n    /**\r\n     * Enables or disables the snapshot rendering mode\r\n     * Note that the WebGL engine does not support snapshot rendering so setting the value won't have any effect for this engine\r\n     */\r\n    public get snapshotRendering(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public set snapshotRendering(activate) {\r\n        // Do nothing\r\n    }\r\n\r\n    /**\r\n     * Gets or sets the snapshot rendering mode\r\n     */\r\n    public get snapshotRenderingMode(): number {\r\n        return Constants.SNAPSHOTRENDERING_STANDARD;\r\n    }\r\n\r\n    public set snapshotRenderingMode(mode: number) {}\r\n\r\n    /**\r\n     * Observable event triggered before each texture is initialized\r\n     */\r\n    public onBeforeTextureInitObservable = new Observable<Texture>();\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating if the engine must keep rendering even if the window is not in foreground\r\n     */\r\n    public renderEvenInBackground = true;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that cache can be kept between frames\r\n     */\r\n    public preventCacheWipeBetweenFrames = false;\r\n\r\n    /**\r\n     * Returns the string \"AbstractEngine\"\r\n     * @returns \"AbstractEngine\"\r\n     */\r\n    public getClassName(): string {\r\n        return \"AbstractEngine\";\r\n    }\r\n\r\n    /**\r\n     * Gets the default empty texture\r\n     */\r\n    public get emptyTexture(): InternalTexture {\r\n        if (!this._emptyTexture) {\r\n            this._emptyTexture = this.createRawTexture(new Uint8Array(4), 1, 1, Constants.TEXTUREFORMAT_RGBA, false, false, Constants.TEXTURE_NEAREST_SAMPLINGMODE);\r\n        }\r\n\r\n        return this._emptyTexture;\r\n    }\r\n\r\n    /**\r\n     * Gets the default empty 3D texture\r\n     */\r\n    public get emptyTexture3D(): InternalTexture {\r\n        if (!this._emptyTexture3D) {\r\n            this._emptyTexture3D = this.createRawTexture3D(new Uint8Array(4), 1, 1, 1, Constants.TEXTUREFORMAT_RGBA, false, false, Constants.TEXTURE_NEAREST_SAMPLINGMODE);\r\n        }\r\n\r\n        return this._emptyTexture3D;\r\n    }\r\n\r\n    /**\r\n     * Gets the default empty 2D array texture\r\n     */\r\n    public get emptyTexture2DArray(): InternalTexture {\r\n        if (!this._emptyTexture2DArray) {\r\n            this._emptyTexture2DArray = this.createRawTexture2DArray(\r\n                new Uint8Array(4),\r\n                1,\r\n                1,\r\n                1,\r\n                Constants.TEXTUREFORMAT_RGBA,\r\n                false,\r\n                false,\r\n                Constants.TEXTURE_NEAREST_SAMPLINGMODE\r\n            );\r\n        }\r\n\r\n        return this._emptyTexture2DArray;\r\n    }\r\n\r\n    /**\r\n     * Gets the default empty cube texture\r\n     */\r\n    public get emptyCubeTexture(): InternalTexture {\r\n        if (!this._emptyCubeTexture) {\r\n            const faceData = new Uint8Array(4);\r\n            const cubeData = [faceData, faceData, faceData, faceData, faceData, faceData];\r\n            this._emptyCubeTexture = this.createRawCubeTexture(\r\n                cubeData,\r\n                1,\r\n                Constants.TEXTUREFORMAT_RGBA,\r\n                Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n                false,\r\n                false,\r\n                Constants.TEXTURE_NEAREST_SAMPLINGMODE\r\n            );\r\n        }\r\n\r\n        return this._emptyCubeTexture;\r\n    }\r\n\r\n    /** @internal */\r\n    public _frameHandler: number = 0;\r\n\r\n    /** @internal */\r\n    protected _activeRenderLoops = new Array<() => void>();\r\n\r\n    /**\r\n     * Gets the list of current active render loop functions\r\n     * @returns a read only array with the current render loop functions\r\n     */\r\n    public get activeRenderLoops(): ReadonlyArray<() => void> {\r\n        return this._activeRenderLoops;\r\n    }\r\n\r\n    /**\r\n     * stop executing a render loop function and remove it from the execution array\r\n     * @param renderFunction defines the function to be removed. If not provided all functions will be removed.\r\n     */\r\n    public stopRenderLoop(renderFunction?: () => void): void {\r\n        if (!renderFunction) {\r\n            this._activeRenderLoops.length = 0;\r\n            this._cancelFrame();\r\n            return;\r\n        }\r\n\r\n        const index = this._activeRenderLoops.indexOf(renderFunction);\r\n\r\n        if (index >= 0) {\r\n            this._activeRenderLoops.splice(index, 1);\r\n            if (this._activeRenderLoops.length == 0) {\r\n                this._cancelFrame();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _cancelFrame() {\r\n        if (this._frameHandler !== 0) {\r\n            const handlerToCancel = this._frameHandler;\r\n            this._frameHandler = 0;\r\n\r\n            if (!IsWindowObjectExist()) {\r\n                if (typeof cancelAnimationFrame === \"function\") {\r\n                    return cancelAnimationFrame(handlerToCancel);\r\n                }\r\n            } else {\r\n                const { cancelAnimationFrame } = this.getHostWindow() || window;\r\n                if (typeof cancelAnimationFrame === \"function\") {\r\n                    return cancelAnimationFrame(handlerToCancel);\r\n                }\r\n            }\r\n            return clearTimeout(handlerToCancel);\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _windowIsBackground = false;\r\n\r\n    /**\r\n     * Begin a new frame\r\n     */\r\n    public beginFrame(): void {\r\n        this.onBeginFrameObservable.notifyObservers(this);\r\n    }\r\n\r\n    /**\r\n     * End the current frame\r\n     */\r\n    public endFrame(): void {\r\n        this._frameId++;\r\n\r\n        this.onEndFrameObservable.notifyObservers(this);\r\n    }\r\n\r\n    /**\r\n     * Gets the performance monitor attached to this engine\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/optimize_your_scene#engineinstrumentation\r\n     */\r\n    public abstract get performanceMonitor(): PerformanceMonitor;\r\n\r\n    /** @internal */\r\n    public _boundRenderFunction: any = (timestamp: number) => this._renderLoop(timestamp);\r\n\r\n    protected _maxFPS: number | undefined;\r\n    protected _minFrameTime: number;\r\n    protected _lastFrameTime: number = 0;\r\n    protected _renderAccumulator: number = 0;\r\n\r\n    /**\r\n     * Skip frame rendering but keep the frame heartbeat (begin/end frame).\r\n     * This is useful if you need all the plumbing but not the rendering work.\r\n     * (for instance when capturing a screenshot where you do not want to mix rendering to the screen and to the screenshot)\r\n     */\r\n    public skipFrameRender = false;\r\n\r\n    /** Gets or sets max frame per second allowed. Will return undefined if not capped */\r\n    public get maxFPS(): number | undefined {\r\n        return this._maxFPS;\r\n    }\r\n\r\n    public set maxFPS(value: number | undefined) {\r\n        this._maxFPS = value;\r\n\r\n        if (value === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (value <= 0) {\r\n            this._minFrameTime = Number.MAX_VALUE;\r\n            return;\r\n        }\r\n\r\n        this._minFrameTime = 1000 / value;\r\n    }\r\n\r\n    protected _isOverFrameTime(timestamp?: number): boolean {\r\n        if (!timestamp || this._maxFPS === undefined) {\r\n            return false;\r\n        }\r\n\r\n        const elapsedTime = timestamp - this._lastFrameTime;\r\n        this._lastFrameTime = timestamp;\r\n\r\n        this._renderAccumulator += elapsedTime;\r\n\r\n        if (this._renderAccumulator < this._minFrameTime) {\r\n            return true;\r\n        }\r\n\r\n        this._renderAccumulator -= this._minFrameTime;\r\n\r\n        if (this._renderAccumulator > this._minFrameTime) {\r\n            this._renderAccumulator = this._minFrameTime;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    protected _processFrame(timestamp?: number) {\r\n        this._frameHandler = 0;\r\n\r\n        if (!this._contextWasLost && !this._isOverFrameTime(timestamp)) {\r\n            let shouldRender = true;\r\n            if (this.isDisposed || (!this.renderEvenInBackground && this._windowIsBackground)) {\r\n                shouldRender = false;\r\n            }\r\n\r\n            if (shouldRender) {\r\n                // Start new frame\r\n                this.beginFrame();\r\n\r\n                // Child canvases\r\n                if (!this.skipFrameRender && !this._renderViews()) {\r\n                    // Main frame\r\n                    this._renderFrame();\r\n                }\r\n\r\n                // Present\r\n                this.endFrame();\r\n            }\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _renderLoop(timestamp: number | undefined): void {\r\n        this._processFrame(timestamp);\r\n\r\n        // The first condition prevents queuing another frame if we no longer have active render loops (e.g., if\r\n        // `stopRenderLoop` is called mid frame). The second condition prevents queuing another frame if one has\r\n        // already been queued (e.g., if `stopRenderLoop` and `runRenderLoop` is called mid frame).\r\n        if (this._activeRenderLoops.length > 0 && this._frameHandler === 0) {\r\n            this._frameHandler = this._queueNewFrame(this._boundRenderFunction, this.getHostWindow());\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _renderFrame() {\r\n        for (let index = 0; index < this._activeRenderLoops.length; index++) {\r\n            const renderFunction = this._activeRenderLoops[index];\r\n\r\n            renderFunction();\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _renderViews() {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Can be used to override the current requestAnimationFrame requester.\r\n     * @internal\r\n     */\r\n    protected _queueNewFrame(bindedRenderFunction: any, requester?: any): number {\r\n        return QueueNewFrame(bindedRenderFunction, requester);\r\n    }\r\n\r\n    /**\r\n     * Register and execute a render loop. The engine can have more than one render function\r\n     * @param renderFunction defines the function to continuously execute\r\n     */\r\n    public runRenderLoop(renderFunction: () => void): void {\r\n        if (this._activeRenderLoops.indexOf(renderFunction) !== -1) {\r\n            return;\r\n        }\r\n\r\n        this._activeRenderLoops.push(renderFunction);\r\n\r\n        // On the first added function, start the render loop.\r\n        if (this._activeRenderLoops.length === 1 && this._frameHandler === 0) {\r\n            this._frameHandler = this._queueNewFrame(this._boundRenderFunction, this.getHostWindow());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if depth testing is enabled\r\n     * @returns the current state\r\n     */\r\n    public getDepthBuffer(): boolean {\r\n        return this._depthCullingState.depthTest;\r\n    }\r\n\r\n    /**\r\n     * Enable or disable depth buffering\r\n     * @param enable defines the state to set\r\n     */\r\n    public setDepthBuffer(enable: boolean): void {\r\n        this._depthCullingState.depthTest = enable;\r\n    }\r\n\r\n    /**\r\n     * Set the z offset Factor to apply to current rendering\r\n     * @param value defines the offset to apply\r\n     */\r\n    public setZOffset(value: number): void {\r\n        this._depthCullingState.zOffset = this.useReverseDepthBuffer ? -value : value;\r\n    }\r\n\r\n    /**\r\n     * Gets the current value of the zOffset Factor\r\n     * @returns the current zOffset Factor state\r\n     */\r\n    public getZOffset(): number {\r\n        const zOffset = this._depthCullingState.zOffset;\r\n        return this.useReverseDepthBuffer ? -zOffset : zOffset;\r\n    }\r\n\r\n    /**\r\n     * Set the z offset Units to apply to current rendering\r\n     * @param value defines the offset to apply\r\n     */\r\n    public setZOffsetUnits(value: number): void {\r\n        this._depthCullingState.zOffsetUnits = this.useReverseDepthBuffer ? -value : value;\r\n    }\r\n\r\n    /**\r\n     * Gets the current value of the zOffset Units\r\n     * @returns the current zOffset Units state\r\n     */\r\n    public getZOffsetUnits(): number {\r\n        const zOffsetUnits = this._depthCullingState.zOffsetUnits;\r\n        return this.useReverseDepthBuffer ? -zOffsetUnits : zOffsetUnits;\r\n    }\r\n\r\n    /**\r\n     * Gets host window\r\n     * @returns the host window object\r\n     */\r\n    public getHostWindow(): Nullable<Window> {\r\n        if (!IsWindowObjectExist()) {\r\n            return null;\r\n        }\r\n\r\n        if (this._renderingCanvas && this._renderingCanvas.ownerDocument && this._renderingCanvas.ownerDocument.defaultView) {\r\n            return this._renderingCanvas.ownerDocument.defaultView;\r\n        }\r\n\r\n        return window;\r\n    }\r\n\r\n    /**\r\n     * (WebGPU only) True (default) to be in compatibility mode, meaning rendering all existing scenes without artifacts (same rendering than WebGL).\r\n     * Setting the property to false will improve performances but may not work in some scenes if some precautions are not taken.\r\n     * See https://doc.babylonjs.com/setup/support/webGPU/webGPUOptimization/webGPUNonCompatibilityMode for more details\r\n     */\r\n    public get compatibilityMode() {\r\n        return this._compatibilityMode;\r\n    }\r\n\r\n    public set compatibilityMode(mode: boolean) {\r\n        // not supported in WebGL\r\n        this._compatibilityMode = true;\r\n    }\r\n\r\n    /**\r\n     * Observable raised when the engine is about to compile a shader\r\n     */\r\n    public onBeforeShaderCompilationObservable = new Observable<AbstractEngine>();\r\n\r\n    /**\r\n     * Observable raised when the engine has just compiled a shader\r\n     */\r\n    public onAfterShaderCompilationObservable = new Observable<AbstractEngine>();\r\n\r\n    /**\r\n     * Observable raised when the engine begins a new frame\r\n     */\r\n    public onBeginFrameObservable = new Observable<AbstractEngine>();\r\n\r\n    /**\r\n     * Observable raised when the engine ends the current frame (requires a render loop, e.g. 'engine.runRenderLoop(...)')\r\n     */\r\n    public onEndFrameObservable = new Observable<AbstractEngine>();\r\n\r\n    protected _rebuildTextures(): void {\r\n        for (const scene of this.scenes) {\r\n            scene._rebuildTextures();\r\n        }\r\n\r\n        for (const scene of this._virtualScenes) {\r\n            scene._rebuildTextures();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public abstract _getRGBABufferInternalSizedFormat(type: number, format?: number, useSRGBBuffer?: boolean): number;\r\n\r\n    /** @internal */\r\n    public abstract _getUnpackAlignement(): number;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public abstract _uploadCompressedDataToTextureDirectly(\r\n        texture: InternalTexture,\r\n        internalFormat: number,\r\n        width: number,\r\n        height: number,\r\n        data: ArrayBufferView,\r\n        faceIndex: number,\r\n        lod?: number\r\n    ): void;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public abstract _bindTextureDirectly(target: number, texture: Nullable<InternalTexture>, forTextureDataUpdate?: boolean, force?: boolean): boolean;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public abstract _uploadDataToTextureDirectly(\r\n        texture: InternalTexture,\r\n        imageData: ArrayBufferView,\r\n        faceIndex?: number,\r\n        lod?: number,\r\n        babylonInternalFormat?: number,\r\n        useTextureWidthAndHeight?: boolean\r\n    ): void;\r\n\r\n    /** @internal */\r\n    public abstract _unpackFlipY(value: boolean): void;\r\n\r\n    /**\r\n     * Reads pixels from the current frame buffer. Please note that this function can be slow\r\n     * @param x defines the x coordinate of the rectangle where pixels must be read\r\n     * @param y defines the y coordinate of the rectangle where pixels must be read\r\n     * @param width defines the width of the rectangle where pixels must be read\r\n     * @param height defines the height of the rectangle where pixels must be read\r\n     * @param hasAlpha defines whether the output should have alpha or not (defaults to true)\r\n     * @param flushRenderer true to flush the renderer from the pending commands before reading the pixels\r\n     * @returns a ArrayBufferView promise (Uint8Array) containing RGBA colors\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public abstract readPixels(x: number, y: number, width: number, height: number, hasAlpha?: boolean, flushRenderer?: boolean): Promise<ArrayBufferView>;\r\n\r\n    /**\r\n     * Generates mipmaps for a texture\r\n     * @param texture The texture to generate the mipmaps for\r\n     */\r\n    public abstract generateMipmaps(texture: InternalTexture): void;\r\n\r\n    /**\r\n     * Force a flush (ie. a flush of all waiting commands)\r\n     */\r\n    public abstract flushFramebuffer(): void;\r\n\r\n    /** @internal */\r\n    public abstract _currentFrameBufferIsDefaultFrameBuffer(): boolean;\r\n\r\n    /**\r\n     * Creates an internal texture without binding it to a framebuffer\r\n     * @internal\r\n     * @param size defines the size of the texture\r\n     * @param options defines the options used to create the texture\r\n     * @param delayGPUTextureCreation true to delay the texture creation the first time it is really needed. false to create it right away\r\n     * @param source source type of the texture\r\n     * @returns a new internal texture\r\n     */\r\n    public abstract _createInternalTexture(\r\n        size: TextureSize,\r\n        options: boolean | InternalTextureCreationOptions,\r\n        delayGPUTextureCreation?: boolean,\r\n        source?: InternalTextureSource\r\n    ): InternalTexture;\r\n\r\n    /** @internal */\r\n    public abstract applyStates(): void;\r\n\r\n    /**\r\n     * Binds the frame buffer to the specified texture.\r\n     * @param texture The render target wrapper to render to\r\n     * @param faceIndex The face of the texture to render to in case of cube texture\r\n     * @param requiredWidth The width of the target to render to\r\n     * @param requiredHeight The height of the target to render to\r\n     * @param forceFullscreenViewport Forces the viewport to be the entire texture/screen if true\r\n     * @param lodLevel defines the lod level to bind to the frame buffer\r\n     * @param layer defines the 2d array index to bind to frame buffer to\r\n     */\r\n    public abstract bindFramebuffer(\r\n        texture: RenderTargetWrapper,\r\n        faceIndex?: number,\r\n        requiredWidth?: number,\r\n        requiredHeight?: number,\r\n        forceFullscreenViewport?: boolean,\r\n        lodLevel?: number,\r\n        layer?: number\r\n    ): void;\r\n\r\n    /**\r\n     * Update the sampling mode of a given texture\r\n     * @param texture defines the texture to update\r\n     * @param wrapU defines the texture wrap mode of the u coordinates\r\n     * @param wrapV defines the texture wrap mode of the v coordinates\r\n     * @param wrapR defines the texture wrap mode of the r coordinates\r\n     */\r\n    public abstract updateTextureWrappingMode(texture: InternalTexture, wrapU: Nullable<number>, wrapV?: Nullable<number>, wrapR?: Nullable<number>): void;\r\n\r\n    /**\r\n     * Unbind the current render target and bind the default framebuffer\r\n     */\r\n    public abstract restoreDefaultFramebuffer(): void;\r\n\r\n    /**\r\n     * Draw a list of indexed primitives\r\n     * @param fillMode defines the primitive to use\r\n     * @param indexStart defines the starting index\r\n     * @param indexCount defines the number of index to draw\r\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\r\n     */\r\n    public abstract drawElementsType(fillMode: number, indexStart: number, indexCount: number, instancesCount?: number): void;\r\n\r\n    /**\r\n     * Unbind the current render target texture from the webGL context\r\n     * @param texture defines the render target wrapper to unbind\r\n     * @param disableGenerateMipMaps defines a boolean indicating that mipmaps must not be generated\r\n     * @param onBeforeUnbind defines a function which will be called before the effective unbind\r\n     */\r\n    public abstract unBindFramebuffer(texture: RenderTargetWrapper, disableGenerateMipMaps?: boolean, onBeforeUnbind?: () => void): void;\r\n\r\n    /**\r\n     * Generates mipmaps for the texture of the (single) render target\r\n     * @param texture The render target containing the texture to generate the mipmaps for\r\n     */\r\n    public abstract generateMipMapsFramebuffer(texture: RenderTargetWrapper): void;\r\n\r\n    /**\r\n     * Resolves the MSAA texture of the (single) render target into its non-MSAA version.\r\n     * Note that if \"texture\" is not a MSAA render target, no resolve is performed.\r\n     * @param texture The render target texture containing the MSAA texture to resolve\r\n     */\r\n    public abstract resolveFramebuffer(texture: RenderTargetWrapper): void;\r\n\r\n    /**Gets driver info if available */\r\n    public abstract extractDriverInfo(): string;\r\n\r\n    /**\r\n     * Bind a list of vertex buffers to the webGL context\r\n     * @param vertexBuffers defines the list of vertex buffers to bind\r\n     * @param indexBuffer defines the index buffer to bind\r\n     * @param effect defines the effect associated with the vertex buffers\r\n     * @param overrideVertexBuffers defines optional list of avertex buffers that overrides the entries in vertexBuffers\r\n     */\r\n    public abstract bindBuffers(\r\n        vertexBuffers: { [key: string]: Nullable<VertexBuffer> },\r\n        indexBuffer: Nullable<DataBuffer>,\r\n        effect: Effect,\r\n        overrideVertexBuffers?: { [kind: string]: Nullable<VertexBuffer> }\r\n    ): void;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _releaseRenderTargetWrapper(rtWrapper: RenderTargetWrapper): void {\r\n        const index = this._renderTargetWrapperCache.indexOf(rtWrapper);\r\n        if (index !== -1) {\r\n            this._renderTargetWrapperCache.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Activates an effect, making it the current one (i.e. the one used for rendering)\r\n     * @param effect defines the effect to activate\r\n     */\r\n    public abstract enableEffect(effect: Nullable<Effect | DrawWrapper>): void;\r\n\r\n    /**\r\n     * Sets the type of faces to cull\r\n     * @param cullBackFaces true to cull back faces, false to cull front faces (if culling is enabled)\r\n     * @param force defines if states must be applied even if cache is up to date\r\n     */\r\n    public abstract setStateCullFaceType(cullBackFaces?: boolean, force?: boolean): void;\r\n\r\n    /**\r\n     * Set various states to the webGL context\r\n     * @param culling defines culling state: true to enable culling, false to disable it\r\n     * @param zOffset defines the value to apply to zOffset (0 by default)\r\n     * @param force defines if states must be applied even if cache is up to date\r\n     * @param reverseSide defines if culling must be reversed (CCW if false, CW if true)\r\n     * @param cullBackFaces true to cull back faces, false to cull front faces (if culling is enabled)\r\n     * @param stencil stencil states to set\r\n     * @param zOffsetUnits defines the value to apply to zOffsetUnits (0 by default)\r\n     */\r\n    public abstract setState(\r\n        culling: boolean,\r\n        zOffset?: number,\r\n        force?: boolean,\r\n        reverseSide?: boolean,\r\n        cullBackFaces?: boolean,\r\n        stencil?: IStencilState | IStencilStateProperties,\r\n        zOffsetUnits?: number\r\n    ): void;\r\n\r\n    /**\r\n     * Creates a new material context\r\n     * @returns the new context\r\n     */\r\n    public abstract createMaterialContext(): IMaterialContext | undefined;\r\n\r\n    /**\r\n     * Creates a new draw context\r\n     * @returns the new context\r\n     */\r\n    public abstract createDrawContext(): IDrawContext | undefined;\r\n\r\n    /**\r\n     * Create a new effect (used to store vertex/fragment shaders)\r\n     * @param baseName defines the base name of the effect (The name of file without .fragment.fx or .vertex.fx)\r\n     * @param attributesNamesOrOptions defines either a list of attribute names or an IEffectCreationOptions object\r\n     * @param uniformsNamesOrEngine defines either a list of uniform names or the engine to use\r\n     * @param samplers defines an array of string used to represent textures\r\n     * @param defines defines the string containing the defines to use to compile the shaders\r\n     * @param fallbacks defines the list of potential fallbacks to use if shader compilation fails\r\n     * @param onCompiled defines a function to call when the effect creation is successful\r\n     * @param onError defines a function to call when the effect creation has failed\r\n     * @param indexParameters defines an object containing the index values to use to compile shaders (like the maximum number of simultaneous lights)\r\n     * @param shaderLanguage the language the shader is written in (default: GLSL)\r\n     * @param extraInitializationsAsync additional async code to run before preparing the effect\r\n     * @returns the new Effect\r\n     */\r\n    public abstract createEffect(\r\n        baseName: string | (IShaderPath & { vertexToken?: string; fragmentToken?: string }),\r\n        attributesNamesOrOptions: string[] | IEffectCreationOptions,\r\n        uniformsNamesOrEngine: string[] | AbstractEngine,\r\n        samplers?: string[],\r\n        defines?: string,\r\n        fallbacks?: EffectFallbacks,\r\n        onCompiled?: Nullable<(effect: Effect) => void>,\r\n        onError?: Nullable<(effect: Effect, errors: string) => void>,\r\n        indexParameters?: any,\r\n        shaderLanguage?: ShaderLanguage,\r\n        extraInitializationsAsync?: () => Promise<void>\r\n    ): Effect;\r\n\r\n    /**\r\n     * Clear the current render buffer or the current render target (if any is set up)\r\n     * @param color defines the color to use\r\n     * @param backBuffer defines if the back buffer must be cleared\r\n     * @param depth defines if the depth buffer must be cleared\r\n     * @param stencil defines if the stencil buffer must be cleared\r\n     * @param stencilClearValue defines the value to use to clear the stencil buffer\r\n     */\r\n    public abstract clear(color: Nullable<IColor4Like>, backBuffer: boolean, depth: boolean, stencil?: boolean, stencilClearValue?: number): void;\r\n\r\n    /**\r\n     * Gets a boolean indicating that only power of 2 textures are supported\r\n     * Please note that you can still use non power of 2 textures but in this case the engine will forcefully convert them\r\n     */\r\n    public abstract get needPOTTextures(): boolean;\r\n\r\n    /**\r\n     * Creates a new index buffer\r\n     * @param indices defines the content of the index buffer\r\n     * @param _updatable defines if the index buffer must be updatable\r\n     * @param label defines the label of the buffer (for debug purpose)\r\n     * @returns a new buffer\r\n     */\r\n    public abstract createIndexBuffer(indices: IndicesArray, _updatable?: boolean, label?: string): DataBuffer;\r\n\r\n    /**\r\n     * Draw a list of unindexed primitives\r\n     * @param fillMode defines the primitive to use\r\n     * @param verticesStart defines the index of first vertex to draw\r\n     * @param verticesCount defines the count of vertices to draw\r\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\r\n     */\r\n    public abstract drawArraysType(fillMode: number, verticesStart: number, verticesCount: number, instancesCount?: number): void;\r\n\r\n    /**\r\n     * Force the engine to release all cached effects.\r\n     * This means that next effect compilation will have to be done completely even if a similar effect was already compiled\r\n     */\r\n    public abstract releaseEffects(): void;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public abstract _viewport(x: number, y: number, width: number, height: number): void;\r\n\r\n    /**\r\n     * Gets the current viewport\r\n     */\r\n    public get currentViewport(): Nullable<IViewportLike> {\r\n        return this._cachedViewport;\r\n    }\r\n\r\n    /**\r\n     * Set the WebGL's viewport\r\n     * @param viewport defines the viewport element to be used\r\n     * @param requiredWidth defines the width required for rendering. If not provided the rendering canvas' width is used\r\n     * @param requiredHeight defines the height required for rendering. If not provided the rendering canvas' height is used\r\n     */\r\n    public setViewport(viewport: IViewportLike, requiredWidth?: number, requiredHeight?: number): void {\r\n        const width = requiredWidth || this.getRenderWidth();\r\n        const height = requiredHeight || this.getRenderHeight();\r\n        const x = viewport.x || 0;\r\n        const y = viewport.y || 0;\r\n\r\n        this._cachedViewport = viewport;\r\n\r\n        this._viewport(x * width, y * height, width * viewport.width, height * viewport.height);\r\n    }\r\n\r\n    /**\r\n     * Update the sampling mode of a given texture\r\n     * @param samplingMode defines the required sampling mode\r\n     * @param texture defines the texture to update\r\n     * @param generateMipMaps defines whether to generate mipmaps for the texture\r\n     */\r\n    public abstract updateTextureSamplingMode(samplingMode: number, texture: InternalTexture, generateMipMaps?: boolean): void;\r\n\r\n    /**\r\n     * Sets an array of texture to the webGL context\r\n     * @param channel defines the channel where the texture array must be set\r\n     * @param uniform defines the associated uniform location\r\n     * @param textures defines the array of textures to bind\r\n     * @param name name of the channel\r\n     */\r\n    public abstract setTextureArray(channel: number, uniform: Nullable<WebGLUniformLocation>, textures: ThinTexture[], name: string): void;\r\n\r\n    /** @internal */\r\n    public _transformTextureUrl: Nullable<(url: string) => string> = null;\r\n\r\n    /**\r\n     * Unbind all instance attributes\r\n     */\r\n    public abstract unbindInstanceAttributes(): void;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public abstract _getUseSRGBBuffer(useSRGBBuffer: boolean, noMipmap: boolean): boolean;\r\n\r\n    /**\r\n     * Create an image to use with canvas\r\n     * @returns IImage interface\r\n     */\r\n    public createCanvasImage(): IImage {\r\n        return document.createElement(\"img\");\r\n    }\r\n\r\n    /**\r\n     * Create a 2D path to use with canvas\r\n     * @returns IPath2D interface\r\n     * @param d SVG path string\r\n     */\r\n    public createCanvasPath2D(d?: string): IPath2D {\r\n        return new Path2D(d);\r\n    }\r\n\r\n    /**\r\n     * Returns a string describing the current engine\r\n     */\r\n    public get description(): string {\r\n        let description = this.name + this.version;\r\n\r\n        if (this._caps.parallelShaderCompile) {\r\n            description += \" - Parallel shader compilation\";\r\n        }\r\n\r\n        return description;\r\n    }\r\n\r\n    protected _createTextureBase(\r\n        url: Nullable<string>,\r\n        noMipmap: boolean,\r\n        invertY: boolean,\r\n        scene: Nullable<ISceneLike>,\r\n        samplingMode: number = Constants.TEXTURE_TRILINEAR_SAMPLINGMODE,\r\n        onLoad: Nullable<(texture: InternalTexture) => void> = null,\r\n        onError: Nullable<(message: string, exception: any) => void> = null,\r\n        prepareTexture: PrepareTextureFunction,\r\n        prepareTextureProcess: PrepareTextureProcessFunction,\r\n        buffer: Nullable<string | ArrayBuffer | ArrayBufferView | HTMLImageElement | Blob | ImageBitmap> = null,\r\n        fallback: Nullable<InternalTexture> = null,\r\n        format: Nullable<number> = null,\r\n        forcedExtension: Nullable<string> = null,\r\n        mimeType?: string,\r\n        loaderOptions?: any,\r\n        useSRGBBuffer?: boolean\r\n    ): InternalTexture {\r\n        url = url || \"\";\r\n        const fromData = url.substring(0, 5) === \"data:\";\r\n        const fromBlob = url.substring(0, 5) === \"blob:\";\r\n        const isBase64 = fromData && url.indexOf(\";base64,\") !== -1;\r\n\r\n        const texture = fallback ? fallback : new InternalTexture(this, InternalTextureSource.Url);\r\n\r\n        if (texture !== fallback) {\r\n            texture.label = url.substring(0, 60); // default label, can be overriden by the caller\r\n        }\r\n\r\n        const originalUrl = url;\r\n        if (this._transformTextureUrl && !isBase64 && !fallback && !buffer) {\r\n            url = this._transformTextureUrl(url);\r\n        }\r\n\r\n        if (originalUrl !== url) {\r\n            texture._originalUrl = originalUrl;\r\n        }\r\n\r\n        // establish the file extension, if possible\r\n        const lastDot = url.lastIndexOf(\".\");\r\n        let extension = forcedExtension ? forcedExtension : lastDot > -1 ? url.substring(lastDot).toLowerCase() : \"\";\r\n\r\n        // Remove query string\r\n        const queryStringIndex = extension.indexOf(\"?\");\r\n\r\n        if (queryStringIndex > -1) {\r\n            extension = extension.split(\"?\")[0];\r\n        }\r\n\r\n        const loaderPromise = AbstractEngine.GetCompatibleTextureLoader(extension, mimeType);\r\n\r\n        if (scene) {\r\n            scene.addPendingData(texture);\r\n        }\r\n        texture.url = url;\r\n        texture.generateMipMaps = !noMipmap;\r\n        texture.samplingMode = samplingMode;\r\n        texture.invertY = invertY;\r\n        texture._useSRGBBuffer = this._getUseSRGBBuffer(!!useSRGBBuffer, noMipmap);\r\n\r\n        if (!this._doNotHandleContextLost) {\r\n            // Keep a link to the buffer only if we plan to handle context lost\r\n            texture._buffer = buffer;\r\n        }\r\n\r\n        let onLoadObserver: Nullable<Observer<InternalTexture>> = null;\r\n        if (onLoad && !fallback) {\r\n            onLoadObserver = texture.onLoadedObservable.add(onLoad);\r\n        }\r\n\r\n        if (!fallback) {\r\n            this._internalTexturesCache.push(texture);\r\n        }\r\n\r\n        const onInternalError = (message?: string, exception?: any) => {\r\n            if (scene) {\r\n                scene.removePendingData(texture);\r\n            }\r\n\r\n            if (url === originalUrl) {\r\n                if (onLoadObserver) {\r\n                    texture.onLoadedObservable.remove(onLoadObserver);\r\n                }\r\n\r\n                if (EngineStore.UseFallbackTexture && url !== EngineStore.FallbackTexture) {\r\n                    this._createTextureBase(\r\n                        EngineStore.FallbackTexture,\r\n                        noMipmap,\r\n                        texture.invertY,\r\n                        scene,\r\n                        samplingMode,\r\n                        null,\r\n                        onError,\r\n                        prepareTexture,\r\n                        prepareTextureProcess,\r\n                        buffer,\r\n                        texture\r\n                    );\r\n                }\r\n\r\n                message = (message || \"Unknown error\") + (EngineStore.UseFallbackTexture ? \" - Fallback texture was used\" : \"\");\r\n                texture.onErrorObservable.notifyObservers({ message, exception });\r\n                if (onError) {\r\n                    onError(message, exception);\r\n                }\r\n            } else {\r\n                // fall back to the original url if the transformed url fails to load\r\n                Logger.Warn(`Failed to load ${url}, falling back to ${originalUrl}`);\r\n                this._createTextureBase(\r\n                    originalUrl,\r\n                    noMipmap,\r\n                    texture.invertY,\r\n                    scene,\r\n                    samplingMode,\r\n                    onLoad,\r\n                    onError,\r\n                    prepareTexture,\r\n                    prepareTextureProcess,\r\n                    buffer,\r\n                    texture,\r\n                    format,\r\n                    forcedExtension,\r\n                    mimeType,\r\n                    loaderOptions,\r\n                    useSRGBBuffer\r\n                );\r\n            }\r\n        };\r\n\r\n        // processing for non-image formats\r\n        if (loaderPromise) {\r\n            const callbackAsync = async (data: ArrayBufferView) => {\r\n                const loader = await loaderPromise;\r\n                loader.loadData(\r\n                    data,\r\n                    texture,\r\n                    (width: number, height: number, loadMipmap: boolean, isCompressed: boolean, done: () => void, loadFailed) => {\r\n                        if (loadFailed) {\r\n                            onInternalError(\"TextureLoader failed to load data\");\r\n                        } else {\r\n                            prepareTexture(\r\n                                texture,\r\n                                extension,\r\n                                scene,\r\n                                { width, height },\r\n                                texture.invertY,\r\n                                !loadMipmap,\r\n                                isCompressed,\r\n                                () => {\r\n                                    done();\r\n                                    return false;\r\n                                },\r\n                                samplingMode\r\n                            );\r\n                        }\r\n                    },\r\n                    loaderOptions\r\n                );\r\n            };\r\n\r\n            if (!buffer) {\r\n                this._loadFile(\r\n                    url,\r\n                    (data) => {\r\n                        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n                        callbackAsync(new Uint8Array(data as ArrayBuffer));\r\n                    },\r\n                    undefined,\r\n                    scene ? scene.offlineProvider : undefined,\r\n                    true,\r\n                    (request?: IWebRequest, exception?: any) => {\r\n                        onInternalError(\"Unable to load \" + (request ? request.responseURL : url, exception));\r\n                    }\r\n                );\r\n            } else {\r\n                if (buffer instanceof ArrayBuffer) {\r\n                    // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n                    callbackAsync(new Uint8Array(buffer));\r\n                } else if (ArrayBuffer.isView(buffer)) {\r\n                    // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n                    callbackAsync(buffer);\r\n                } else {\r\n                    if (onError) {\r\n                        onError(\"Unable to load: only ArrayBuffer or ArrayBufferView is supported\", null);\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            const onload = (img: HTMLImageElement | ImageBitmap) => {\r\n                if (fromBlob && !this._doNotHandleContextLost) {\r\n                    // We need to store the image if we need to rebuild the texture\r\n                    // in case of a webgl context lost\r\n                    texture._buffer = img;\r\n                }\r\n\r\n                prepareTexture(texture, extension, scene, img, texture.invertY, noMipmap, false, prepareTextureProcess, samplingMode);\r\n            };\r\n            // According to the WebGL spec section 6.10, ImageBitmaps must be inverted on creation.\r\n            // So, we pass imageOrientation to _FileToolsLoadImage() as it may create an ImageBitmap.\r\n\r\n            if (!fromData || isBase64) {\r\n                if (buffer && (typeof (<HTMLImageElement>buffer).decoding === \"string\" || (<ImageBitmap>buffer).close)) {\r\n                    onload(<HTMLImageElement>buffer);\r\n                } else {\r\n                    AbstractEngine._FileToolsLoadImage(\r\n                        url || \"\",\r\n                        onload,\r\n                        onInternalError,\r\n                        scene ? scene.offlineProvider : null,\r\n                        mimeType,\r\n                        texture.invertY && this._features.needsInvertingBitmap ? { imageOrientation: \"flipY\" } : undefined,\r\n                        this\r\n                    );\r\n                }\r\n            } else if (typeof buffer === \"string\" || buffer instanceof ArrayBuffer || ArrayBuffer.isView(buffer) || buffer instanceof Blob) {\r\n                AbstractEngine._FileToolsLoadImage(\r\n                    buffer,\r\n                    onload,\r\n                    onInternalError,\r\n                    scene ? scene.offlineProvider : null,\r\n                    mimeType,\r\n                    texture.invertY && this._features.needsInvertingBitmap ? { imageOrientation: \"flipY\" } : undefined,\r\n                    this\r\n                );\r\n            } else if (buffer) {\r\n                onload(buffer);\r\n            }\r\n        }\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Creates a new pipeline context\r\n     * @param shaderProcessingContext defines the shader processing context used during the processing if available\r\n     * @returns the new pipeline\r\n     */\r\n    public abstract createPipelineContext(shaderProcessingContext: Nullable<_IShaderProcessingContext>): IPipelineContext;\r\n\r\n    /**\r\n     * Inline functions in shader code that are marked to be inlined\r\n     * @param code code to inline\r\n     * @returns inlined code\r\n     */\r\n    public abstract inlineShaderCode(code: string): string;\r\n\r\n    /**\r\n     * Gets a boolean indicating that the engine supports uniform buffers\r\n     */\r\n    public abstract get supportsUniformBuffers(): boolean;\r\n\r\n    /**\r\n     * Returns the version of the engine\r\n     */\r\n    public abstract get version(): number;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public abstract _releaseEffect(effect: Effect): void;\r\n\r\n    /**\r\n     * Bind a buffer to the current draw context\r\n     * @param buffer defines the buffer to bind\r\n     * @param _location not used in WebGPU\r\n     * @param name Name of the uniform variable to bind\r\n     */\r\n    public abstract bindUniformBufferBase(buffer: DataBuffer, _location: number, name: string): void;\r\n\r\n    /**\r\n     * Bind a specific block at a given index in a specific shader program\r\n     * @param pipelineContext defines the pipeline context to use\r\n     * @param blockName defines the block name\r\n     * @param index defines the index where to bind the block\r\n     */\r\n    public abstract bindUniformBlock(pipelineContext: IPipelineContext, blockName: string, index: number): void;\r\n\r\n    /** @internal */\r\n    public _uniformBuffers = new Array<UniformBuffer>();\r\n    /** @internal */\r\n    public _storageBuffers = new Array<StorageBuffer>();\r\n    protected _rebuildBuffers(): void {\r\n        // Uniforms\r\n        for (const uniformBuffer of this._uniformBuffers) {\r\n            uniformBuffer._rebuildAfterContextLost();\r\n        }\r\n    }\r\n\r\n    protected _highPrecisionShadersAllowed = true;\r\n    /** @internal */\r\n    public get _shouldUseHighPrecisionShader(): boolean {\r\n        return !!(this._caps.highPrecisionShaderSupported && this._highPrecisionShadersAllowed);\r\n    }\r\n    /**\r\n     * @internal\r\n     */\r\n    public abstract _getShaderProcessingContext(shaderLanguage: ShaderLanguage, pureMode: boolean): Nullable<_IShaderProcessingContext>;\r\n\r\n    /**\r\n     * Gets host document\r\n     * @returns the host document object\r\n     */\r\n    public getHostDocument(): Nullable<Document> {\r\n        if (this._renderingCanvas && this._renderingCanvas.ownerDocument) {\r\n            return this._renderingCanvas.ownerDocument;\r\n        }\r\n\r\n        return IsDocumentAvailable() ? document : null;\r\n    }\r\n\r\n    // Lost context\r\n    /**\r\n     * Observable signaled when a context lost event is raised\r\n     */\r\n    public onContextLostObservable = new Observable<AbstractEngine>();\r\n    /**\r\n     * Observable signaled when a context restored event is raised\r\n     */\r\n    public onContextRestoredObservable = new Observable<AbstractEngine>();\r\n\r\n    /**\r\n     * Gets the list of loaded textures\r\n     * @returns an array containing all loaded textures\r\n     */\r\n    public getLoadedTexturesCache(): InternalTexture[] {\r\n        return this._internalTexturesCache;\r\n    }\r\n\r\n    /**\r\n     * Clears the list of texture accessible through engine.\r\n     * This can help preventing texture load conflict due to name collision.\r\n     */\r\n    public clearInternalTexturesCache() {\r\n        this._internalTexturesCache.length = 0;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public abstract _releaseTexture(texture: InternalTexture): void;\r\n\r\n    /**\r\n     * Gets the object containing all engine capabilities\r\n     * @returns the EngineCapabilities object\r\n     */\r\n    public getCaps(): EngineCapabilities {\r\n        return this._caps;\r\n    }\r\n\r\n    /**\r\n     * Reset the texture cache to empty state\r\n     */\r\n    public resetTextureCache() {\r\n        for (const key in this._boundTexturesCache) {\r\n            if (!Object.prototype.hasOwnProperty.call(this._boundTexturesCache, key)) {\r\n                continue;\r\n            }\r\n            this._boundTexturesCache[key] = null;\r\n        }\r\n\r\n        this._currentTextureChannel = -1;\r\n    }\r\n\r\n    /** @internal */\r\n    protected _name = \"\";\r\n\r\n    /**\r\n     * Gets or sets the name of the engine\r\n     */\r\n    public get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n    public set name(value: string) {\r\n        this._name = value;\r\n    }\r\n\r\n    /**\r\n     * Returns the current npm package of the sdk\r\n     */\r\n    // Not mixed with Version for tooling purpose.\r\n    public static get NpmPackage(): string {\r\n        return \"babylonjs@8.49.1\";\r\n    }\r\n\r\n    /**\r\n     * Returns the current version of the framework\r\n     */\r\n    public static get Version(): string {\r\n        return \"8.49.1\";\r\n    }\r\n\r\n    /**\r\n     * The time (in milliseconds elapsed since the current page has been loaded) when the engine was initialized\r\n     */\r\n    public readonly startTime: number;\r\n\r\n    /** @internal */\r\n    protected _audioContext: Nullable<AudioContext>;\r\n    /** @internal */\r\n    protected _audioDestination: Nullable<AudioDestinationNode | MediaStreamAudioDestinationNode>;\r\n    /**\r\n     * Gets the HTML canvas attached with the current webGL context\r\n     * @returns a HTML canvas\r\n     */\r\n    public getRenderingCanvas(): Nullable<HTMLCanvasElement> {\r\n        return this._renderingCanvas;\r\n    }\r\n\r\n    /**\r\n     * Gets the audio context specified in engine initialization options\r\n     * @deprecated please use AudioEngineV2 instead\r\n     * @returns an Audio Context\r\n     */\r\n    public getAudioContext(): Nullable<AudioContext> {\r\n        return this._audioContext;\r\n    }\r\n\r\n    /**\r\n     * Gets the audio destination specified in engine initialization options\r\n     * @deprecated please use AudioEngineV2 instead\r\n     * @returns an audio destination node\r\n     */\r\n    public getAudioDestination(): Nullable<AudioDestinationNode | MediaStreamAudioDestinationNode> {\r\n        return this._audioDestination;\r\n    }\r\n\r\n    /**\r\n     * Defines whether the engine has been created with the premultipliedAlpha option on or not.\r\n     */\r\n    public premultipliedAlpha: boolean = true;\r\n\r\n    /**\r\n     * If set to true zooming in and out in the browser will rescale the hardware-scaling correctly.\r\n     */\r\n    public adaptToDeviceRatio: boolean = false;\r\n\r\n    /** @internal */\r\n    protected _lastDevicePixelRatio: number = 1.0;\r\n\r\n    /** @internal */\r\n    public _hardwareScalingLevel: number;\r\n\r\n    /**\r\n     * Defines the hardware scaling level.\r\n     * By default the hardware scaling level is computed from the window device ratio.\r\n     * if level = 1 then the engine will render at the exact resolution of the canvas. If level = 0.5 then the engine will render at twice the size of the canvas.\r\n     * @param level defines the level to use\r\n     */\r\n    public setHardwareScalingLevel(level: number): void {\r\n        this._hardwareScalingLevel = level;\r\n        this.resize();\r\n    }\r\n\r\n    /**\r\n     * Gets the current hardware scaling level.\r\n     * By default the hardware scaling level is computed from the window device ratio.\r\n     * if level = 1 then the engine will render at the exact resolution of the canvas. If level = 0.5 then the engine will render at twice the size of the canvas.\r\n     * @returns a number indicating the current hardware scaling level\r\n     */\r\n    public getHardwareScalingLevel(): number {\r\n        return this._hardwareScalingLevel;\r\n    }\r\n\r\n    /** @internal */\r\n    public _doNotHandleContextLost = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating if resources should be retained to be able to handle context lost events\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/optimize_your_scene#handling-webgl-context-lost\r\n     */\r\n    public get doNotHandleContextLost(): boolean {\r\n        return this._doNotHandleContextLost;\r\n    }\r\n\r\n    public set doNotHandleContextLost(value: boolean) {\r\n        this._doNotHandleContextLost = value;\r\n    }\r\n\r\n    /** @internal */\r\n    protected _isStencilEnable: boolean;\r\n\r\n    /**\r\n     * Returns true if the stencil buffer has been enabled through the creation option of the context.\r\n     */\r\n    public get isStencilEnable(): boolean {\r\n        return this._isStencilEnable;\r\n    }\r\n\r\n    /** @internal */\r\n    protected _creationOptions: AbstractEngineOptions;\r\n\r\n    /**\r\n     * Gets the options used for engine creation\r\n     * NOTE that modifying the object after engine creation will have no effect\r\n     * @returns EngineOptions object\r\n     */\r\n    public getCreationOptions() {\r\n        return this._creationOptions;\r\n    }\r\n\r\n    /**\r\n     * Creates a new engine\r\n     * @param antialias defines whether anti-aliasing should be enabled. If undefined, it means that the underlying engine is free to enable it or not\r\n     * @param options defines further options to be sent to the creation context\r\n     * @param adaptToDeviceRatio defines whether to adapt to the device's viewport characteristics (default: false)\r\n     */\r\n    constructor(antialias: boolean | undefined, options: AbstractEngineOptions, adaptToDeviceRatio?: boolean) {\r\n        EngineStore.Instances.push(this);\r\n        this.startTime = PrecisionDate.Now;\r\n\r\n        this._stencilStateComposer.stencilGlobal = this._stencilState;\r\n\r\n        // LargeWorldRendering set to true will set high precision matrix, regardless of useHighPrecisionMatrix value\r\n        // It will also set all scenes to use floatingOriginMode upon their creation\r\n        PerformanceConfigurator.SetMatrixPrecision(!!options.useLargeWorldRendering || !!options.useHighPrecisionMatrix);\r\n\r\n        if (IsNavigatorAvailable() && navigator.userAgent) {\r\n            // Detect if we are running on a faulty buggy OS.\r\n            this._badOS = /iPad/i.test(navigator.userAgent) || /iPhone/i.test(navigator.userAgent);\r\n\r\n            // Detect if we are running on a faulty buggy desktop OS.\r\n            this._badDesktopOS = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\r\n        }\r\n\r\n        // Save this off for use in resize().\r\n        this.adaptToDeviceRatio = adaptToDeviceRatio ?? false;\r\n\r\n        options.antialias = antialias ?? options.antialias;\r\n        options.deterministicLockstep = options.deterministicLockstep ?? false;\r\n        options.lockstepMaxSteps = options.lockstepMaxSteps ?? 4;\r\n        options.timeStep = options.timeStep ?? 1 / 60;\r\n        options.stencil = options.stencil ?? true;\r\n\r\n        this._audioContext = options.audioEngineOptions?.audioContext ?? null;\r\n        this._audioDestination = options.audioEngineOptions?.audioDestination ?? null;\r\n        this.premultipliedAlpha = options.premultipliedAlpha ?? true;\r\n        this._doNotHandleContextLost = !!options.doNotHandleContextLost;\r\n        this._isStencilEnable = options.stencil ? true : false;\r\n        this.useExactSrgbConversions = options.useExactSrgbConversions ?? false;\r\n\r\n        const devicePixelRatio = IsWindowObjectExist() ? window.devicePixelRatio || 1.0 : 1.0;\r\n\r\n        const limitDeviceRatio = options.limitDeviceRatio || devicePixelRatio;\r\n        // Viewport\r\n        adaptToDeviceRatio = adaptToDeviceRatio || options.adaptToDeviceRatio || false;\r\n        this._hardwareScalingLevel = adaptToDeviceRatio ? 1.0 / Math.min(limitDeviceRatio, devicePixelRatio) : 1.0;\r\n        this._lastDevicePixelRatio = devicePixelRatio;\r\n\r\n        this._creationOptions = options;\r\n    }\r\n\r\n    /**\r\n     * Resize the view according to the canvas' size\r\n     * @param forceSetSize true to force setting the sizes of the underlying canvas\r\n     */\r\n    public resize(forceSetSize = false): void {\r\n        let width: number;\r\n        let height: number;\r\n\r\n        // Re-query hardware scaling level to handle zoomed-in resizing.\r\n        if (this.adaptToDeviceRatio) {\r\n            const devicePixelRatio = IsWindowObjectExist() ? window.devicePixelRatio || 1.0 : 1.0;\r\n            const changeRatio = this._lastDevicePixelRatio / devicePixelRatio;\r\n            this._lastDevicePixelRatio = devicePixelRatio;\r\n            this._hardwareScalingLevel *= changeRatio;\r\n        }\r\n\r\n        if (IsWindowObjectExist() && IsDocumentAvailable()) {\r\n            // make sure it is a Node object, and is a part of the document.\r\n            if (this._renderingCanvas) {\r\n                const boundingRect = this._renderingCanvas.getBoundingClientRect?.();\r\n                width = this._renderingCanvas.clientWidth || boundingRect?.width || this._renderingCanvas.width * this._hardwareScalingLevel || 100;\r\n                height = this._renderingCanvas.clientHeight || boundingRect?.height || this._renderingCanvas.height * this._hardwareScalingLevel || 100;\r\n            } else {\r\n                width = window.innerWidth;\r\n                height = window.innerHeight;\r\n            }\r\n        } else {\r\n            width = this._renderingCanvas ? this._renderingCanvas.width : 100;\r\n            height = this._renderingCanvas ? this._renderingCanvas.height : 100;\r\n        }\r\n\r\n        this.setSize(width / this._hardwareScalingLevel, height / this._hardwareScalingLevel, forceSetSize);\r\n    }\r\n\r\n    /**\r\n     * Force a specific size of the canvas\r\n     * @param width defines the new canvas' width\r\n     * @param height defines the new canvas' height\r\n     * @param forceSetSize true to force setting the sizes of the underlying canvas\r\n     * @returns true if the size was changed\r\n     */\r\n    public setSize(width: number, height: number, forceSetSize = false): boolean {\r\n        if (!this._renderingCanvas) {\r\n            return false;\r\n        }\r\n\r\n        width = width | 0;\r\n        height = height | 0;\r\n\r\n        if (!forceSetSize && this._renderingCanvas.width === width && this._renderingCanvas.height === height) {\r\n            return false;\r\n        }\r\n\r\n        this._renderingCanvas.width = width;\r\n        this._renderingCanvas.height = height;\r\n\r\n        if (this.scenes) {\r\n            for (let index = 0; index < this.scenes.length; index++) {\r\n                const scene = this.scenes[index];\r\n\r\n                for (let camIndex = 0; camIndex < scene.cameras.length; camIndex++) {\r\n                    const cam = scene.cameras[camIndex];\r\n\r\n                    cam._currentRenderId = 0;\r\n                }\r\n            }\r\n\r\n            if (this.onResizeObservable.hasObservers()) {\r\n                this.onResizeObservable.notifyObservers(this);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public abstract _releaseBuffer(buffer: DataBuffer): boolean;\r\n\r\n    /**\r\n     * Create a dynamic uniform buffer\r\n     * @see https://doc.babylonjs.com/setup/support/webGL2#uniform-buffer-objets\r\n     * @param elements defines the content of the uniform buffer\r\n     * @param label defines a name for the buffer (for debugging purpose)\r\n     * @returns the webGL uniform buffer\r\n     */\r\n    public abstract createDynamicUniformBuffer(elements: FloatArray, label?: string): DataBuffer;\r\n\r\n    /**\r\n     * Create an uniform buffer\r\n     * @see https://doc.babylonjs.com/setup/support/webGL2#uniform-buffer-objets\r\n     * @param elements defines the content of the uniform buffer\r\n     * @param label defines a name for the buffer (for debugging purpose)\r\n     * @returns the webGL uniform buffer\r\n     */\r\n    public abstract createUniformBuffer(elements: FloatArray, label?: string): DataBuffer;\r\n\r\n    /**\r\n     * Update an existing uniform buffer\r\n     * @see https://doc.babylonjs.com/setup/support/webGL2#uniform-buffer-objets\r\n     * @param uniformBuffer defines the target uniform buffer\r\n     * @param elements defines the content to update\r\n     * @param offset defines the offset in the uniform buffer where update should start\r\n     * @param count defines the size of the data to update\r\n     */\r\n    public abstract updateUniformBuffer(uniformBuffer: DataBuffer, elements: FloatArray, offset?: number, count?: number): void;\r\n\r\n    /**\r\n     * Creates a dynamic vertex buffer\r\n     * @param data the data for the dynamic vertex buffer\r\n     * @param _label defines the label of the buffer (for debug purpose)\r\n     * @returns the new WebGL dynamic buffer\r\n     */\r\n    public abstract createDynamicVertexBuffer(data: DataArray | number, _label?: string): DataBuffer;\r\n\r\n    /**\r\n     * Creates a vertex buffer\r\n     * @param data the data or size for the vertex buffer\r\n     * @param _updatable whether the buffer should be created as updatable\r\n     * @param _label defines the label of the buffer (for debug purpose)\r\n     * @returns the new WebGL static buffer\r\n     */\r\n    public abstract createVertexBuffer(data: DataArray | number, _updatable?: boolean, _label?: string): DataBuffer;\r\n\r\n    /**\r\n     * Update the dimensions of a texture\r\n     * @param texture texture to update\r\n     * @param width new width of the texture\r\n     * @param height new height of the texture\r\n     * @param depth new depth of the texture\r\n     */\r\n    public abstract updateTextureDimensions(texture: InternalTexture, width: number, height: number, depth: number): void;\r\n\r\n    /**\r\n     * Usually called from Texture.ts.\r\n     * Passed information to create a WebGLTexture\r\n     * @param url defines a value which contains one of the following:\r\n     * * A conventional http URL, e.g. 'http://...' or 'file://...'\r\n     * * A base64 string of in-line texture data, e.g. 'data:image/jpg;base64,/...'\r\n     * * An indicator that data being passed using the buffer parameter, e.g. 'data:mytexture.jpg'\r\n     * @param noMipmap defines a boolean indicating that no mipmaps shall be generated.  Ignored for compressed textures.  They must be in the file\r\n     * @param invertY when true, image is flipped when loaded.  You probably want true. Certain compressed textures may invert this if their default is inverted (eg. ktx)\r\n     * @param scene needed for loading to the correct scene\r\n     * @param samplingMode mode with should be used sample / access the texture (Default: Texture.TRILINEAR_SAMPLINGMODE)\r\n     * @param onLoad optional callback to be called upon successful completion\r\n     * @param onError optional callback to be called upon failure\r\n     * @param buffer a source of a file previously fetched as either a base64 string, an ArrayBuffer (compressed or image format), HTMLImageElement (image format), or a Blob\r\n     * @param fallback an internal argument in case the function must be called again, due to etc1 not having alpha capabilities\r\n     * @param format internal format.  Default: RGB when extension is '.jpg' else RGBA.  Ignored for compressed textures\r\n     * @param forcedExtension defines the extension to use to pick the right loader\r\n     * @param mimeType defines an optional mime type\r\n     * @param loaderOptions options to be passed to the loader\r\n     * @param creationFlags specific flags to use when creating the texture (Constants.TEXTURE_CREATIONFLAG_STORAGE for storage textures, for eg)\r\n     * @param useSRGBBuffer defines if the texture must be loaded in a sRGB GPU buffer (if supported by the GPU).\r\n     * @returns a InternalTexture for assignment back into BABYLON.Texture\r\n     */\r\n    public abstract createTexture(\r\n        url: Nullable<string>,\r\n        noMipmap: boolean,\r\n        invertY: boolean,\r\n        scene: Nullable<ISceneLike>,\r\n        samplingMode?: number,\r\n        onLoad?: Nullable<(texture: InternalTexture) => void>,\r\n        onError?: Nullable<(message: string, exception: any) => void>,\r\n        buffer?: Nullable<string | ArrayBuffer | ArrayBufferView | HTMLImageElement | Blob | ImageBitmap>,\r\n        fallback?: Nullable<InternalTexture>,\r\n        format?: Nullable<number>,\r\n        forcedExtension?: Nullable<string>,\r\n        mimeType?: string,\r\n        loaderOptions?: any,\r\n        creationFlags?: number,\r\n        useSRGBBuffer?: boolean\r\n    ): InternalTexture;\r\n\r\n    // eslint-disable-next-line jsdoc/require-returns-check\r\n    /**\r\n     * Creates a raw texture\r\n     * @param data defines the data to store in the texture\r\n     * @param width defines the width of the texture\r\n     * @param height defines the height of the texture\r\n     * @param format defines the format of the data\r\n     * @param generateMipMaps defines if the engine should generate the mip levels\r\n     * @param invertY defines if data must be stored with Y axis inverted\r\n     * @param samplingMode defines the required sampling mode (Texture.NEAREST_SAMPLINGMODE by default)\r\n     * @param compression defines the compression used (null by default)\r\n     * @param type defines the type fo the data (Engine.TEXTURETYPE_UNSIGNED_BYTE by default)\r\n     * @param creationFlags specific flags to use when creating the texture (Constants.TEXTURE_CREATIONFLAG_STORAGE for storage textures, for eg)\r\n     * @param useSRGBBuffer defines if the texture must be loaded in a sRGB GPU buffer (if supported by the GPU).\r\n     * @param mipLevelCount defines the number of mip levels to allocate for the texture\r\n     * @returns the raw texture inside an InternalTexture\r\n     */\r\n    public createRawTexture(\r\n        data: Nullable<ArrayBufferView>,\r\n        width: number,\r\n        height: number,\r\n        format: number,\r\n        generateMipMaps: boolean,\r\n        invertY: boolean,\r\n        samplingMode: number,\r\n        compression?: Nullable<string>,\r\n        type?: number,\r\n        creationFlags?: number,\r\n        useSRGBBuffer?: boolean,\r\n        mipLevelCount?: number\r\n    ): InternalTexture {\r\n        throw _WarnImport(\"engine.rawTexture\");\r\n    }\r\n\r\n    // eslint-disable-next-line jsdoc/require-returns-check\r\n    /**\r\n     * Creates a new raw cube texture\r\n     * @param data defines the array of data to use to create each face\r\n     * @param size defines the size of the textures\r\n     * @param format defines the format of the data\r\n     * @param type defines the type of the data (like Engine.TEXTURETYPE_UNSIGNED_BYTE)\r\n     * @param generateMipMaps  defines if the engine should generate the mip levels\r\n     * @param invertY defines if data must be stored with Y axis inverted\r\n     * @param samplingMode defines the required sampling mode (like Texture.NEAREST_SAMPLINGMODE)\r\n     * @param compression defines the compression used (null by default)\r\n     * @returns the cube texture as an InternalTexture\r\n     */\r\n    public createRawCubeTexture(\r\n        data: Nullable<ArrayBufferView[]>,\r\n        size: number,\r\n        format: number,\r\n        type: number,\r\n        generateMipMaps: boolean,\r\n        invertY: boolean,\r\n        samplingMode: number,\r\n        compression?: Nullable<string>\r\n    ): InternalTexture {\r\n        throw _WarnImport(\"engine.rawTexture\");\r\n    }\r\n    // eslint-disable-next-line jsdoc/require-returns-check\r\n    /**\r\n     * Creates a new raw 3D texture\r\n     * @param data defines the data used to create the texture\r\n     * @param width defines the width of the texture\r\n     * @param height defines the height of the texture\r\n     * @param depth defines the depth of the texture\r\n     * @param format defines the format of the texture\r\n     * @param generateMipMaps defines if the engine must generate mip levels\r\n     * @param invertY defines if data must be stored with Y axis inverted\r\n     * @param samplingMode defines the required sampling mode (like Texture.NEAREST_SAMPLINGMODE)\r\n     * @param compression defines the compressed used (can be null)\r\n     * @param textureType defines the compressed used (can be null)\r\n     * @param creationFlags specific flags to use when creating the texture (Constants.TEXTURE_CREATIONFLAG_STORAGE for storage textures, for eg)\r\n     * @returns a new raw 3D texture (stored in an InternalTexture)\r\n     */\r\n    public createRawTexture3D(\r\n        data: Nullable<ArrayBufferView>,\r\n        width: number,\r\n        height: number,\r\n        depth: number,\r\n        format: number,\r\n        generateMipMaps: boolean,\r\n        invertY: boolean,\r\n        samplingMode: number,\r\n        compression?: Nullable<string>,\r\n        textureType?: number,\r\n        creationFlags?: number\r\n    ): InternalTexture {\r\n        throw _WarnImport(\"engine.rawTexture\");\r\n    }\r\n\r\n    // eslint-disable-next-line jsdoc/require-returns-check\r\n    /**\r\n     * Creates a new raw 2D array texture\r\n     * @param data defines the data used to create the texture\r\n     * @param width defines the width of the texture\r\n     * @param height defines the height of the texture\r\n     * @param depth defines the number of layers of the texture\r\n     * @param format defines the format of the texture\r\n     * @param generateMipMaps defines if the engine must generate mip levels\r\n     * @param invertY defines if data must be stored with Y axis inverted\r\n     * @param samplingMode defines the required sampling mode (like Texture.NEAREST_SAMPLINGMODE)\r\n     * @param compression defines the compressed used (can be null)\r\n     * @param textureType defines the compressed used (can be null)\r\n     * @param creationFlags specific flags to use when creating the texture (Constants.TEXTURE_CREATIONFLAG_STORAGE for storage textures, for eg)\r\n     * @param mipLevelCount defines the number of mip levels to allocate for the texture\r\n     * @returns a new raw 2D array texture (stored in an InternalTexture)\r\n     */\r\n    public createRawTexture2DArray(\r\n        data: Nullable<ArrayBufferView>,\r\n        width: number,\r\n        height: number,\r\n        depth: number,\r\n        format: number,\r\n        generateMipMaps: boolean,\r\n        invertY: boolean,\r\n        samplingMode: number,\r\n        compression?: Nullable<string>,\r\n        textureType?: number,\r\n        creationFlags?: number,\r\n        mipLevelCount?: number\r\n    ): InternalTexture {\r\n        throw _WarnImport(\"engine.rawTexture\");\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating if back faces must be culled. If false, front faces are culled instead (true by default)\r\n     * If non null, this takes precedence over the value from the material\r\n     */\r\n    public cullBackFaces: Nullable<boolean> = null;\r\n\r\n    /**\r\n     * Gets the current render width\r\n     * @param useScreen defines if screen size must be used (or the current render target if any)\r\n     * @returns a number defining the current render width\r\n     */\r\n    public abstract getRenderWidth(useScreen?: boolean): number;\r\n\r\n    /**\r\n     * Gets the current render height\r\n     * @param useScreen defines if screen size must be used (or the current render target if any)\r\n     * @returns a number defining the current render height\r\n     */\r\n    public abstract getRenderHeight(useScreen?: boolean): number;\r\n\r\n    /**\r\n     * Shared initialization across engines types.\r\n     * @param canvas The canvas associated with this instance of the engine.\r\n     */\r\n    protected _sharedInit(canvas: HTMLCanvasElement) {\r\n        this._renderingCanvas = canvas;\r\n    }\r\n\r\n    private _checkForMobile: () => void;\r\n\r\n    protected _setupMobileChecks(): void {\r\n        if (!(navigator && navigator.userAgent)) {\r\n            return;\r\n        }\r\n\r\n        // Function to check if running on mobile device\r\n        this._checkForMobile = () => {\r\n            const currentUa = navigator.userAgent;\r\n            this.hostInformation.isMobile =\r\n                currentUa.indexOf(\"Mobile\") !== -1 ||\r\n                // Needed for iOS 13+ detection on iPad (inspired by solution from https://stackoverflow.com/questions/9038625/detect-if-device-is-ios)\r\n                (currentUa.indexOf(\"Mac\") !== -1 && IsDocumentAvailable() && \"ontouchend\" in document);\r\n        };\r\n\r\n        // Set initial isMobile value\r\n        this._checkForMobile();\r\n\r\n        // Set up event listener to check when window is resized (used to get emulator activation to work properly)\r\n        if (IsWindowObjectExist()) {\r\n            window.addEventListener(\"resize\", this._checkForMobile);\r\n        }\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    /** @internal */\r\n    public static _RenderPassIdCounter = 0;\r\n\r\n    /** @internal */\r\n    public _renderPassNames: string[] = [\"main\"];\r\n\r\n    /** @internal */\r\n    public abstract _createHardwareTexture(): IHardwareTextureWrapper;\r\n\r\n    /**\r\n     * creates and returns a new video element\r\n     * @param constraints video constraints\r\n     * @returns video element\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public createVideoElement(constraints: MediaTrackConstraints): any {\r\n        return document.createElement(\"video\");\r\n    }\r\n\r\n    // FPS\r\n    protected _fps = 60;\r\n    protected _deltaTime = 0;\r\n\r\n    /** @internal */\r\n    public _drawCalls: PerfCounter;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _reportDrawCall(numDrawCalls = 1) {\r\n        this._drawCalls?.addCount(numDrawCalls, false);\r\n    }\r\n    /**\r\n     * Gets the current framerate\r\n     * @returns a number representing the framerate\r\n     */\r\n    public getFps(): number {\r\n        return this._fps;\r\n    }\r\n\r\n    /**\r\n     * Gets the time spent between current and previous frame\r\n     * @returns a number representing the delta time in ms\r\n     */\r\n    public getDeltaTime(): number {\r\n        return this._deltaTime;\r\n    }\r\n\r\n    // Deterministic lockstepMaxSteps\r\n    /** @internal */\r\n    public _deterministicLockstep: boolean = false;\r\n    /** @internal */\r\n    public _lockstepMaxSteps: number = 4;\r\n    /** @internal */\r\n    public _timeStep: number = 1 / 60;\r\n\r\n    /**\r\n     * Gets a boolean indicating that the engine is running in deterministic lock step mode\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/animation/advanced_animations#deterministic-lockstep\r\n     * @returns true if engine is in deterministic lock step mode\r\n     */\r\n    public isDeterministicLockStep(): boolean {\r\n        return this._deterministicLockstep;\r\n    }\r\n\r\n    /**\r\n     * Gets the max steps when engine is running in deterministic lock step\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/animation/advanced_animations#deterministic-lockstep\r\n     * @returns the max steps\r\n     */\r\n    public getLockstepMaxSteps(): number {\r\n        return this._lockstepMaxSteps;\r\n    }\r\n\r\n    /**\r\n     * Returns the time in ms between steps when using deterministic lock step.\r\n     * @returns time step in (ms)\r\n     */\r\n    public getTimeStep(): number {\r\n        return this._timeStep * 1000;\r\n    }\r\n\r\n    /**\r\n     * Engine abstraction for loading and creating an image bitmap from a given source string.\r\n     * @param imageSource source to load the image from.\r\n     * @param options An object that sets options for the image's extraction.\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/promise-function-async\r\n    public _createImageBitmapFromSource(imageSource: string, options?: ImageBitmapOptions): Promise<ImageBitmap> {\r\n        throw new Error(\"createImageBitmapFromSource is not implemented\");\r\n    }\r\n\r\n    /**\r\n     * Engine abstraction for createImageBitmap\r\n     * @param image source for image\r\n     * @param options An object that sets options for the image's extraction.\r\n     * @returns ImageBitmap\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/promise-function-async\r\n    public createImageBitmap(image: ImageBitmapSource, options?: ImageBitmapOptions): Promise<ImageBitmap> {\r\n        return createImageBitmap(image, options);\r\n    }\r\n\r\n    /**\r\n     * Resize an image and returns the image data as an uint8array\r\n     * @param image image to resize\r\n     * @param bufferWidth destination buffer width\r\n     * @param bufferHeight destination buffer height\r\n     */\r\n    public resizeImageBitmap(image: HTMLImageElement | ImageBitmap, bufferWidth: number, bufferHeight: number): Uint8Array {\r\n        throw new Error(\"resizeImageBitmap is not implemented\");\r\n    }\r\n\r\n    /**\r\n     * Get the current error code of the webGL context\r\n     * @returns the error code\r\n     */\r\n    public abstract getError(): number;\r\n\r\n    /**\r\n     * Get Font size information\r\n     * @param font font name\r\n     */\r\n    public getFontOffset(font: string): { ascent: number; height: number; descent: number } {\r\n        throw new Error(\"getFontOffset is not implemented\");\r\n    }\r\n\r\n    protected static _CreateCanvas(width: number, height: number): ICanvas {\r\n        if (typeof document === \"undefined\") {\r\n            return <ICanvas>(<any>new OffscreenCanvas(width, height));\r\n        }\r\n        const canvas = <ICanvas>(<any>document.createElement(\"canvas\"));\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n        return canvas;\r\n    }\r\n\r\n    /**\r\n     * Create a canvas. This method is overridden by other engines\r\n     * @param width width\r\n     * @param height height\r\n     * @returns ICanvas interface\r\n     */\r\n    public createCanvas(width: number, height: number): ICanvas {\r\n        return AbstractEngine._CreateCanvas(width, height);\r\n    }\r\n\r\n    /**\r\n     * Loads an image as an HTMLImageElement.\r\n     * @param input url string, ArrayBuffer, or Blob to load\r\n     * @param onLoad callback called when the image successfully loads\r\n     * @param onError callback called when the image fails to load\r\n     * @param offlineProvider offline provider for caching\r\n     * @param mimeType optional mime type\r\n     * @param imageBitmapOptions optional the options to use when creating an ImageBitmap\r\n     * @param engine the engine instance to use\r\n     * @returns the HTMLImageElement of the loaded image\r\n     * @internal\r\n     */\r\n    public static _FileToolsLoadImage(\r\n        input: string | ArrayBuffer | ArrayBufferView | Blob,\r\n        onLoad: (img: HTMLImageElement | ImageBitmap) => void,\r\n        onError: (message?: string, exception?: any) => void,\r\n        offlineProvider: Nullable<IOfflineProvider>,\r\n        mimeType?: string,\r\n        imageBitmapOptions?: ImageBitmapOptions,\r\n        engine?: AbstractEngine\r\n    ): Nullable<HTMLImageElement> {\r\n        throw _WarnImport(\"FileTools\");\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _loadFile(\r\n        url: string,\r\n        onSuccess: (data: string | ArrayBuffer, responseURL?: string) => void,\r\n        onProgress?: (data: any) => void,\r\n        offlineProvider?: Nullable<IOfflineProvider>,\r\n        useArrayBuffer?: boolean,\r\n        onError?: (request?: IWebRequest, exception?: any) => void\r\n    ): IFileRequest {\r\n        const request = _LoadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError);\r\n        this._activeRequests.push(request);\r\n        request.onCompleteObservable.add(() => {\r\n            const index = this._activeRequests.indexOf(request);\r\n            if (index !== -1) {\r\n                this._activeRequests.splice(index, 1);\r\n            }\r\n        });\r\n        return request;\r\n    }\r\n\r\n    /**\r\n     * Loads a file from a url\r\n     * @param url url to load\r\n     * @param onSuccess callback called when the file successfully loads\r\n     * @param onProgress callback called while file is loading (if the server supports this mode)\r\n     * @param offlineProvider defines the offline provider for caching\r\n     * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n     * @param onError callback called when the file fails to load\r\n     * @returns a file request object\r\n     * @internal\r\n     */\r\n    public static _FileToolsLoadFile(\r\n        url: string,\r\n        onSuccess: (data: string | ArrayBuffer, responseURL?: string) => void,\r\n        onProgress?: (ev: ProgressEvent) => void,\r\n        offlineProvider?: IOfflineProvider,\r\n        useArrayBuffer?: boolean,\r\n        onError?: (request?: WebRequest, exception?: LoadFileError) => void\r\n    ): IFileRequest {\r\n        if (EngineFunctionContext.loadFile) {\r\n            return EngineFunctionContext.loadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError);\r\n        }\r\n        throw _WarnImport(\"FileTools\");\r\n    }\r\n\r\n    /**\r\n     * An event triggered when the engine is disposed.\r\n     */\r\n    public readonly onDisposeObservable = new Observable<AbstractEngine>();\r\n\r\n    /**\r\n     * An event triggered when a global cleanup of all effects is required\r\n     */\r\n    public readonly onReleaseEffectsObservable = new Observable<AbstractEngine>();\r\n\r\n    /**\r\n     * Dispose and release all associated resources\r\n     */\r\n    public dispose(): void {\r\n        this.releaseEffects();\r\n\r\n        this._isDisposed = true;\r\n        this.stopRenderLoop();\r\n\r\n        // Empty texture\r\n        if (this._emptyTexture) {\r\n            this._releaseTexture(this._emptyTexture);\r\n            this._emptyTexture = null;\r\n        }\r\n        if (this._emptyCubeTexture) {\r\n            this._releaseTexture(this._emptyCubeTexture);\r\n            this._emptyCubeTexture = null;\r\n        }\r\n\r\n        this._renderingCanvas = null;\r\n\r\n        // Clear observables\r\n        if (this.onBeforeTextureInitObservable) {\r\n            this.onBeforeTextureInitObservable.clear();\r\n        }\r\n\r\n        // Release postProcesses\r\n        while (this.postProcesses.length) {\r\n            this.postProcesses[0].dispose();\r\n        }\r\n\r\n        // Release scenes\r\n        while (this.scenes.length) {\r\n            this.scenes[0].dispose();\r\n        }\r\n\r\n        while (this._virtualScenes.length) {\r\n            this._virtualScenes[0].dispose();\r\n        }\r\n\r\n        // Release effects\r\n        this.releaseComputeEffects?.();\r\n\r\n        Effect.ResetCache();\r\n\r\n        // Abort active requests\r\n        for (const request of this._activeRequests) {\r\n            request.abort();\r\n        }\r\n\r\n        this._boundRenderFunction = null;\r\n\r\n        this.onDisposeObservable.notifyObservers(this);\r\n        this.onDisposeObservable.clear();\r\n\r\n        this.onResizeObservable.clear();\r\n        this.onCanvasBlurObservable.clear();\r\n        this.onCanvasFocusObservable.clear();\r\n        this.onCanvasPointerOutObservable.clear();\r\n        this.onNewSceneAddedObservable.clear();\r\n        this.onEffectErrorObservable.clear();\r\n\r\n        if (IsWindowObjectExist()) {\r\n            window.removeEventListener(\"resize\", this._checkForMobile);\r\n        }\r\n\r\n        // Remove from Instances\r\n        const index = EngineStore.Instances.indexOf(this);\r\n\r\n        if (index >= 0) {\r\n            EngineStore.Instances.splice(index, 1);\r\n        }\r\n\r\n        // no more engines left in the engine store? Notify!\r\n        if (!EngineStore.Instances.length) {\r\n            EngineStore.OnEnginesDisposedObservable.notifyObservers(this);\r\n            EngineStore.OnEnginesDisposedObservable.clear();\r\n        }\r\n\r\n        // Observables\r\n        this.onBeginFrameObservable.clear();\r\n        this.onEndFrameObservable.clear();\r\n    }\r\n\r\n    /**\r\n     * Method called to create the default rescale post process on each engine.\r\n     */\r\n    public static _RescalePostProcessFactory: Nullable<(engine: AbstractEngine) => PostProcess> = null;\r\n\r\n    /**\r\n     * Method called to create the default loading screen.\r\n     * This can be overridden in your own app.\r\n     * @param canvas The rendering canvas element\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public static DefaultLoadingScreenFactory(canvas: HTMLCanvasElement): ILoadingScreen {\r\n        throw _WarnImport(\"LoadingScreen\");\r\n    }\r\n\r\n    /**\r\n     * Gets the audio engine\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/audio/playingSoundsMusic\r\n     * @deprecated please use AudioEngineV2 instead\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static audioEngine: Nullable<IAudioEngine>;\r\n\r\n    /**\r\n     * Default AudioEngine factory responsible of creating the Audio Engine.\r\n     * By default, this will create a BabylonJS Audio Engine if the workload has been embedded.\r\n     * @deprecated please use AudioEngineV2 instead\r\n     */\r\n    public static AudioEngineFactory: (\r\n        hostElement: Nullable<HTMLElement>,\r\n        audioContext: Nullable<AudioContext>,\r\n        audioDestination: Nullable<AudioDestinationNode | MediaStreamAudioDestinationNode>\r\n    ) => IAudioEngine;\r\n\r\n    /**\r\n     * Default offline support factory responsible of creating a tool used to store data locally.\r\n     * By default, this will create a Database object if the workload has been embedded.\r\n     */\r\n    public static OfflineProviderFactory: (urlToScene: string, callbackManifestChecked: (checked: boolean) => any, disableManifestCheck: boolean) => IOfflineProvider;\r\n\r\n    /**\r\n     * Will flag all materials in all scenes in all engines as dirty to trigger new shader compilation\r\n     * @param flag defines which part of the materials must be marked as dirty\r\n     * @param predicate defines a predicate used to filter which materials should be affected\r\n     */\r\n    public static MarkAllMaterialsAsDirty(flag: number, predicate?: (mat: Material) => boolean): void {\r\n        for (let engineIndex = 0; engineIndex < EngineStore.Instances.length; engineIndex++) {\r\n            const engine = EngineStore.Instances[engineIndex];\r\n\r\n            for (let sceneIndex = 0; sceneIndex < engine.scenes.length; sceneIndex++) {\r\n                engine.scenes[sceneIndex].markAllMaterialsAsDirty(flag, predicate);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Updatable statics so stick with vars here\r\n\r\n    /**\r\n     * Gets or sets the epsilon value used by collision engine\r\n     */\r\n    public static CollisionsEpsilon = 0.001;\r\n\r\n    /**\r\n     * Queue a new function into the requested animation frame pool (ie. this function will be executed by the browser (or the javascript engine) for the next frame)\r\n     * @param func - the function to be called\r\n     * @param requester - the object that will request the next frame. Falls back to window.\r\n     * @returns frame number\r\n     */\r\n    public static QueueNewFrame: (func: () => void, requester?: any) => number = QueueNewFrame;\r\n\r\n    /**\r\n     * @internal\r\n     * Function used to get the correct texture loader for a specific extension.\r\n     * @param extension defines the file extension of the file being loaded\r\n     * @param mimeType defines the optional mime type of the file being loaded\r\n     * @returns the IInternalTextureLoader or null if it wasn't found\r\n     */\r\n    public static GetCompatibleTextureLoader(_extension: string, _mimeType?: string): Nullable<Promise<IInternalTextureLoader>> {\r\n        return null;\r\n    }\r\n}\r\n"],
  "mappings": "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",
  "names": ["InternalTextureSource", "proxy", "requestAnimationFrame", "cancelAnimationFrame"]
}
